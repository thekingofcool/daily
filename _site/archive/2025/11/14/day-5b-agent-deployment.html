<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><meta name="description" content="you're too slow and have no rhythm. 
" />
    <meta property="og:title" content="Day 5b - Agent Deployment" />
    <meta property="og:description" content="you're too slow and have no rhythm. 
" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://thekingof.cool/archive/2025/11/14/day-5b-agent-deployment.html" />
    <meta property="og:image" content="https://thekingof.cool/assets/images/android-chrome-512x512.png" /><title>Day 5b - Agent Deployment</title><link type="application/atom+xml" rel="alternate" href="daily.thekingof.cool/feed.xml" title="thekingofcool&apos;s daily thoughts" /><link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/images/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/assets/images/android-chrome-512x512.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
  <link rel="manifest" href="/assets/images/site.webmanifest">
  <link href="/assets/css/syntax_monokai.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body a="light">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/"><-</a><article>
  <h1>Day 5b - Agent Deployment</h1>
  <p class="post-meta">
    <span style="float: left;">thekingofcool</span>
    <time datetime="2025-11-14 00:00:00 +0800" style="float: right;">2025-11-14</time>
  </p>
  <div style="clear: both;"></div>
  <h1 id="-deploy-adk-agent-to-vertex-ai-agent-engine">ğŸš€ Deploy ADK Agent to Vertex AI Agent Engine</h1>

<p><strong>Welcome to the final day of the Kaggle 5-day Agents course!</strong></p>

<p>In the previous notebook you learned how to use Agent2Agent Protocol to make your agents interoperable.</p>

<p>Now, letâ€™s take the final step: deploying your agents to production using <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview">Vertex AI Agent Engine</a>.</p>

<h2 id="-scaling-your-agent">ğŸ’¡ Scaling Your Agent</h2>

<p>Youâ€™ve built an amazing AI agent. It works perfectly on your machine. You can chat with it, it responds intelligently, and everything seems ready. But thereâ€™s a problem.</p>

<blockquote>
  <p><strong>Your agent is not publicly available!</strong></p>
</blockquote>

<p>It only lives in your notebook and development environment. When you stop your notebook session, it stops working. Your teammates canâ€™t access it. Your users canâ€™t interact with it. And this is precisely why we need to deploy the agents!</p>

<h2 id="-what-youll-learn">ğŸ¯ What Youâ€™ll Learn</h2>

<p>In this notebook, youâ€™ll:</p>

<ul>
  <li>âœ… Build a production-ready ADK agent</li>
  <li>âœ… Deploy your agent to <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview"><strong>Vertex AI Agent Engine</strong></a> using the ADK CLI</li>
  <li>âœ… Test your deployed agent with Python SDK</li>
  <li>âœ… Monitor and manage deployed agents in Google Cloud Console</li>
  <li>âœ… Understand how to add Memory to your Agent using Vertex AI Memory Bank</li>
  <li>âœ… Understand cost management and cleanup best practices</li>
</ul>

<h2 id="ï¸-section-1-setup">âš™ï¸ Section 1: Setup</h2>

<h3 id="11-ï¸-important-prerequisites">1.1: âš ï¸ <strong>Important: Prerequisites</strong></h3>

<p>This notebook requires a <strong>Google Cloud Platform (GCP) account</strong> to deploy agents to Vertex AI Agent Engine.</p>

<p><strong>If you donâ€™t have a GCP account yet:</strong></p>

<p>âœ… Step 1. <strong>Create a free Google Cloud account</strong> - <a href="https://cloud.google.com/free">Sign up here</a></p>
<ul>
  <li>New users get <strong>$300 in free credits</strong> valid for 90 days</li>
  <li>No charges during the free trial period</li>
</ul>

<p>âœ… Step 2. <strong>Enable billing on your account</strong> - Required even for free tier</p>
<ul>
  <li>A credit card is needed for verification</li>
  <li>You wonâ€™t be charged unless you explicitly upgrade</li>
  <li>This demo stays within the free tier if you clean up resources promptly</li>
</ul>

<p>âœ… Step 3. <strong>Understand the free tier</strong> - Know whatâ€™s included</p>
<ul>
  <li>Deploy up to 10 agents at no cost</li>
  <li>Check <a href="https://cloud.google.com/free/docs/free-cloud-features#free-trial">free tier details</a></li>
  <li>Review <a href="https://cloud.google.com/signup-faqs?hl=en#google-cloud-free-trial-faqs">common questions</a></li>
</ul>

<p><strong>ğŸ’¡ Quick Setup Guide:</strong> Watch this <a href="https://youtu.be/-nUAQq_evxc">3-minute setup video</a> for a walkthrough</p>

<h3 id="12-import-components">1.2: Import components</h3>

<p>Now, import the specific components youâ€™ll need for this notebook. This keeps your code organized and ensures we have access to the necessary building blocks.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">vertexai</span>
<span class="kn">from</span> <span class="n">kaggle_secrets</span> <span class="kn">import</span> <span class="n">UserSecretsClient</span>
<span class="kn">from</span> <span class="n">vertexai</span> <span class="kn">import</span> <span class="n">agent_engines</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">âœ… Imports completed successfully</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ… Imports completed successfully
</code></pre></div></div>

<h3 id="13-add-cloud-credentials-to-secrets">1.3: Add Cloud Credentials to Secrets</h3>

<ol>
  <li>In the top menu bar of the notebook editor, select <code class="language-plaintext highlighter-rouge">Add-ons</code> then <code class="language-plaintext highlighter-rouge">Google Cloud SDK</code>.</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Link Account</code></li>
  <li>Select your Google Cloud Account</li>
  <li>Attach to the notebook</li>
</ol>

<p>This cell retrieves your Google Cloud credentials from Kaggle Secrets and configures them for use. These credentials allow the notebook to authenticate with Google Cloud services like Vertex AI Agent Engine.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set up Cloud Credentials in Kaggle
</span><span class="n">user_secrets</span> <span class="o">=</span> <span class="nc">UserSecretsClient</span><span class="p">()</span>
<span class="n">user_credential</span> <span class="o">=</span> <span class="n">user_secrets</span><span class="p">.</span><span class="nf">get_gcloud_credential</span><span class="p">()</span>
<span class="n">user_secrets</span><span class="p">.</span><span class="nf">set_tensorflow_credential</span><span class="p">(</span><span class="n">user_credential</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">âœ… Cloud credentials configured</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ… Cloud credentials configured
</code></pre></div></div>

<h3 id="14-set-your-project_id">1.4: Set your PROJECT_ID</h3>

<p><strong>Important:</strong> Make sure to replace <code class="language-plaintext highlighter-rouge">"your-project-id"</code> with your actual Google Cloud project ID. You can find your project ID in the <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Set your PROJECT_ID
</span><span class="n">PROJECT_ID</span> <span class="o">=</span> <span class="sh">"</span><span class="s">gen-lang-client-0294379375</span><span class="sh">"</span>  <span class="c1"># TODO: Replace with your project ID
</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_PROJECT</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">PROJECT_ID</span>

<span class="k">if</span> <span class="n">PROJECT_ID</span> <span class="o">==</span> <span class="sh">"</span><span class="s">your-project-id</span><span class="sh">"</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">PROJECT_ID</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">âš ï¸ Please replace </span><span class="sh">'</span><span class="s">your-project-id</span><span class="sh">'</span><span class="s"> with your actual Google Cloud Project ID.</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ… Project ID set to: </span><span class="si">{</span><span class="n">PROJECT_ID</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ… Project ID set to: gen-lang-client-0294379375
</code></pre></div></div>

<h3 id="15-enable-google-cloud-apis">1.5: Enable Google Cloud APIs</h3>

<p>For this tutorial, youâ€™ll need to enable the following APIs in the Google Cloud Console.</p>

<ul>
  <li>Vertex AI API</li>
  <li>Cloud Storage API</li>
  <li>Cloud Logging API</li>
  <li>Cloud Monitoring API</li>
  <li>Cloud Trace API</li>
  <li>Telemetry API</li>
</ul>

<p>You can <a href="https://console.cloud.google.com/flows/enableapi?apiid=aiplatform.googleapis.com,storage.googleapis.com,logging.googleapis.com,monitoring.googleapis.com,cloudtrace.googleapis.com,telemetry.googleapis.com">use this link to open the Google Cloud Console</a> and follow the steps there to enable these APIs.</p>

<hr />

<h2 id="ï¸-section-2-create-your-agent-with-adk">ğŸ—ï¸ Section 2: Create Your Agent with ADK</h2>

<p>Before we deploy, we need a functional agent to host. Weâ€™ll build a <strong>Weather Assistant</strong> designed to serve as our sample agent.</p>

<p>This agent is optimized for production testing with the following configuration:</p>

<ul>
  <li><strong>Model:</strong> Uses gemini-2.5-flash-lite for low latency and cost-efficiency.</li>
  <li><strong>Tools:</strong> Includes a <code class="language-plaintext highlighter-rouge">get_weather</code> function to demonstrate tool execution.</li>
  <li><strong>Persona:</strong> Responds conversationally to prove the instruction-following capabilities.</li>
</ul>

<p>This demonstrates the foundational ADK architecture we are about to package: <strong>Agent + Tools + Instructions</strong>.</p>

<p>Weâ€™ll create the following files and directory structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_agent/
â”œâ”€â”€ agent.py                  # The logic
â”œâ”€â”€ requirements.txt          # The libraries
â”œâ”€â”€ .env                      # The secrets/config
â””â”€â”€ .agent_engine_config.json # The hardware specs
</code></pre></div></div>

<h3 id="21-create-agent-directory">2.1: Create agent directory</h3>

<p>We need a clean workspace to package our agent for deployment. We will create a directory named <code class="language-plaintext highlighter-rouge">sample_agent</code>.</p>

<p>All necessary files - including the agent code, dependencies, and configurationâ€”will be written into this folder to prepare it for the <code class="language-plaintext highlighter-rouge">adk deploy</code> command.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Create simple agent - all code for the agent will live in this directory
</span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">sample_agent</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ… Sample Agent directory created</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ… Sample Agent directory created
</code></pre></div></div>

<h3 id="22-create-requirements-file">2.2: Create requirements file</h3>

<p>The Agent Engine builds a dedicated environment for your agent. To ensure it runs correctly, we must declare our dependencies.</p>

<p>We will write a <code class="language-plaintext highlighter-rouge">requirements.txt</code> file containing the Python packages needed for the agent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>

<span class="n">google</span><span class="o">-</span><span class="n">adk</span>
<span class="n">opentelemetry</span><span class="o">-</span><span class="n">instrumentation</span><span class="o">-</span><span class="n">google</span><span class="o">-</span><span class="n">genai</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/requirements.txt
</code></pre></div></div>

<h3 id="23-create-environment-configuration">2.3: Create environment configuration</h3>

<p>We need to provide the agent with the necessary cloud configuration settings.</p>

<p>We will write a <code class="language-plaintext highlighter-rouge">.env</code> file that sets the cloud location to <code class="language-plaintext highlighter-rouge">global</code> and explicitly enables the Vertex AI backend for the ADK SDK.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">env</span>

<span class="c1"># https://cloud.google.com/vertex-ai/generative-ai/docs/learn/locations#global-endpoint
</span><span class="n">GOOGLE_CLOUD_LOCATION</span><span class="o">=</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span>

<span class="c1"># Set to 1 to use Vertex AI, or 0 to use Google AI Studio
</span><span class="n">GOOGLE_GENAI_USE_VERTEXAI</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/.env
</code></pre></div></div>

<p><strong>Configuration explained:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GOOGLE_CLOUD_LOCATION="global"</code> - Uses the <code class="language-plaintext highlighter-rouge">global</code> endpoint for Gemini API calls</li>
  <li><code class="language-plaintext highlighter-rouge">GOOGLE_GENAI_USE_VERTEXAI=1</code> - Configures ADK to use Vertex AI instead of Google AI Studio</li>
</ul>

<h3 id="24-create-agent-code">2.4: Create agent code</h3>

<p>We will now generate the <code class="language-plaintext highlighter-rouge">agent.py</code> file. This script defines the behavior of our <strong>Weather Assistant</strong>.</p>

<p>Agent Configuration:</p>

<ul>
  <li>ğŸ§  Model: Uses <code class="language-plaintext highlighter-rouge">gemini-2.5-flash-lite</code> for low latency and cost-efficiency.</li>
  <li>ğŸ› ï¸ Tools: Accesses a <code class="language-plaintext highlighter-rouge">get_weather</code> function to retrieve data.</li>
  <li>ğŸ“ Instructions: Follows a system prompt to identify cities and respond in a friendly tone.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="n">agent</span><span class="p">.</span><span class="n">py</span>
<span class="kn">from</span> <span class="n">google.adk.agents</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">import</span> <span class="n">vertexai</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="n">vertexai</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span>
    <span class="n">project</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_PROJECT</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">location</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_LOCATION</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">get_weather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Returns weather information for a given city.

    This is a TOOL that the agent can call when users ask about weather.
    In production, this would call a real weather API (e.g., OpenWeatherMap).
    For this demo, we use mock data.

    Args:
        city: Name of the city (e.g., </span><span class="sh">"</span><span class="s">Tokyo</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="s">)

    Returns:
        dict: Dictionary with status and weather report or error message
    </span><span class="sh">"""</span>
    <span class="c1"># Mock weather database with structured responses
</span>    <span class="n">weather_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">san francisco</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in San Francisco is sunny with a temperature of 72Â°F (22Â°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">new york</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in New York is cloudy with a temperature of 65Â°F (18Â°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">london</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in London is rainy with a temperature of 58Â°F (14Â°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">tokyo</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in Tokyo is clear with a temperature of 70Â°F (21Â°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">paris</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in Paris is partly cloudy with a temperature of 68Â°F (20Â°C).</span><span class="sh">"</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="n">city_lower</span> <span class="o">=</span> <span class="n">city</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">city_lower</span> <span class="ow">in</span> <span class="n">weather_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weather_data</span><span class="p">[</span><span class="n">city_lower</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">available_cities</span> <span class="o">=</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="n">c</span><span class="p">.</span><span class="nf">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">weather_data</span><span class="p">.</span><span class="nf">keys</span><span class="p">()])</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">error_message</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Weather information for </span><span class="sh">'</span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="sh">'</span><span class="s"> is not available. Try: </span><span class="si">{</span><span class="n">available_cities</span><span class="si">}</span><span class="sh">"</span>
        <span class="p">}</span>

<span class="n">root_agent</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">weather_assistant</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Fast, cost-effective Gemini model
</span>    <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">A helpful weather assistant that provides weather information for cities.</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">instruction</span><span class="o">=</span><span class="sh">"""</span><span class="s">
    You are a friendly weather assistant. When users ask about the weather:

    1. Identify the city name from their question
    2. Use the get_weather tool to fetch current weather information
    3. Respond in a friendly, conversational tone
    4. If the city isn</span><span class="sh">'</span><span class="s">t available, suggest one of the available cities

    Be helpful and concise in your responses.
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_weather</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/agent.py
</code></pre></div></div>

<hr />

<h2 id="ï¸-section-3-deploy-to-agent-engine">â˜ï¸ Section 3: Deploy to Agent Engine</h2>

<p>ADK supports multiple deployment platforms. Learn more in the <a href="https://google.github.io/adk-docs/deploy/">ADK deployment documentation</a>.</p>

<p>Youâ€™ll be deploying to <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview">Vertex AI Agent Engine</a> in this notebook.</p>

<h3 id="-vertex-ai-agent-engine">ğŸ”· Vertex AI Agent Engine</h3>

<ul>
  <li><strong>Fully managed</strong> service specifically for AI agents</li>
  <li><strong>Auto-scaling</strong> with session management built-in</li>
  <li><strong>Easy deployment</strong> using <a href="https://github.com/GoogleCloudPlatform/agent-starter-pack">Agent Starter Pack</a></li>
  <li>ğŸ“š <a href="https://google.github.io/adk-docs/deploy/agent-engine/">Deploy to Agent Engine Guide</a></li>
</ul>

<p><strong>Note</strong>: To help you get started with the runtime, Agent Engine offers a monthly free tier, which you can learn more about in the <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview#pricing">documentation</a>. The agent deployed in this notebook should stay within the free tier if cleaned up promptly. Note that you can incur costs if the agent is left running.</p>

<h3 id="-other-deployment-options">ğŸš¢ Other Deployment Options</h3>

<h3 id="-cloud-run">ğŸ”· Cloud Run</h3>

<ul>
  <li>Serverless, easiest to start</li>
  <li>Perfect for demos and small-to-medium workloads</li>
  <li>ğŸ“š <a href="https://google.github.io/adk-docs/deploy/cloud-run/">Deploy to Cloud Run Guide</a></li>
</ul>

<h3 id="-google-kubernetes-engine-gke">ğŸ”· Google Kubernetes Engine (GKE)</h3>

<ul>
  <li>Full control over containerized deployments</li>
  <li>Best for complex multi-agent systems</li>
  <li>ğŸ“š <a href="https://google.github.io/adk-docs/deploy/gke/">Deploy to GKE Guide</a></li>
</ul>

<h3 id="31-create-deployment-configuration">3.1: Create deployment configuration</h3>

<p>The <code class="language-plaintext highlighter-rouge">.agent_engine_config.json</code> file controls the deployment settings.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">agent_engine_config</span><span class="p">.</span><span class="n">json</span>
<span class="p">{</span>
    <span class="sh">"</span><span class="s">min_instances</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">max_instances</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">resource_limits</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">cpu</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">memory</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1Gi</span><span class="sh">"</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/.agent_engine_config.json
</code></pre></div></div>

<p><strong>Configuration explained:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"min_instances": 0</code> - Scales down to zero when not in use (saves costs)</li>
  <li><code class="language-plaintext highlighter-rouge">"max_instances": 1</code> - Maximum of 1 instance running (sufficient for this demo)</li>
  <li><code class="language-plaintext highlighter-rouge">"cpu": "1"</code> - 1 CPU core per instance</li>
  <li><code class="language-plaintext highlighter-rouge">"memory": "1Gi"</code> - 1 GB of memory per instance</li>
</ul>

<p>These settings keep costs minimal while providing adequate resources for our weather agent.</p>

<h3 id="32-select-deployment-region">3.2: Select deployment region</h3>

<p>Agent Engine is available in specific regions. Weâ€™ll randomly select one for this demo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regions_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">europe-west1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">europe-west4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">us-east4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">us-west1</span><span class="sh">"</span><span class="p">]</span>
<span class="n">deployed_region</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">regions_list</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ… Selected deployment region: </span><span class="si">{</span><span class="n">deployed_region</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>âœ… Selected deployment region: us-east4
</code></pre></div></div>

<p><strong>About regions:</strong></p>

<p>Agent Engine is available in multiple regions. For production:</p>

<ul>
  <li>Choose a region close to your users for lower latency</li>
  <li>Consider data residency requirements</li>
  <li>Check the <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/overview#locations">Agent Engine locations documentation</a></li>
</ul>

<h3 id="33-deploy-the-agent">3.3: Deploy the agent</h3>

<p>This uses the ADK CLI to deploy your agent to Agent Engine.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">adk</span> <span class="n">deploy</span> <span class="n">agent_engine</span> <span class="o">--</span><span class="n">project</span><span class="o">=</span><span class="err">$</span><span class="n">PROJECT_ID</span> <span class="o">--</span><span class="n">region</span><span class="o">=</span><span class="err">$</span><span class="n">deployed_region</span> <span class="n">sample_agent</span> <span class="o">--</span><span class="n">agent_engine_config_file</span><span class="o">=</span><span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">agent_engine_config</span><span class="p">.</span><span class="n">json</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Staging all files in: /kaggle/working/sample_agent_tmp20251114_064442
Copying agent source code...
Copying agent source code complete.
Resolving files and dependencies...
Reading agent engine config from sample_agent/.agent_engine_config.json
Reading environment variables from /kaggle/working/sample_agent/.env
[33mIgnoring GOOGLE_CLOUD_LOCATION in .env as `--region` was explicitly passed and takes precedence[0m
Initializing Vertex AI...
Vertex AI initialized.
Created sample_agent_tmp20251114_064442/agent_engine_app.py
Files and dependencies resolved
Deploying to agent engine...
INFO:vertexai_genai.agentengines:Creating in-memory tarfile of source_packages
INFO:vertexai_genai.agentengines:Using agent framework: google-adk
Cleaning up the temp folder: sample_agent_tmp20251114_064442
[31mDeploy failed: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Request had insufficient authentication scopes.', 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'ACCESS_TOKEN_SCOPE_INSUFFICIENT', 'metadata': {'method': 'google.cloud.aiplatform.v1beta1.ReasoningEngineService.CreateReasoningEngine', 'service': 'aiplatform.googleapis.com'}}]}}[0m
</code></pre></div></div>

<p><strong>What just happened:</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">adk deploy agent_engine</code> command:</p>

<ol>
  <li>Packages your agent code (<code class="language-plaintext highlighter-rouge">sample_agent/</code> directory)</li>
  <li>Uploads it to Agent Engine</li>
  <li>Creates a containerized deployment</li>
  <li>Outputs a resource name like: <code class="language-plaintext highlighter-rouge">projects/PROJECT_NUMBER/locations/REGION/reasoningEngines/ID</code></li>
</ol>

<p><strong>Note:</strong> Deployment typically takes 2-5 minutes.</p>

<hr />

<h2 id="-section-4-retrieve-and-test-your-deployed-agent">ğŸ¤– Section 4: Retrieve and Test Your Deployed Agent</h2>

<h3 id="41-retrieve-the-deployed-agent">4.1: Retrieve the deployed agent</h3>

<p>After deploying with the CLI, we need to retrieve the agent object to interact with it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize Vertex AI
</span><span class="n">vertexai</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">PROJECT_ID</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">deployed_region</span><span class="p">)</span>

<span class="c1"># Get the most recently deployed agent
</span><span class="n">agents_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">agent_engines</span><span class="p">.</span><span class="nf">list</span><span class="p">())</span>
<span class="k">if</span> <span class="n">agents_list</span><span class="p">:</span>
    <span class="n">remote_agent</span> <span class="o">=</span> <span class="n">agents_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the first (most recent) agent
</span>    <span class="n">client</span> <span class="o">=</span> <span class="n">agent_engines</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ… Connected to deployed agent: </span><span class="si">{</span><span class="n">remote_agent</span><span class="p">.</span><span class="n">resource_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">âŒ No agents found. Please deploy first.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell retrieves your deployed agent:</p>

<ol>
  <li>Initializes the Vertex AI SDK with your project and region</li>
  <li>Lists all deployed agents in that region</li>
  <li>Gets the first one (most recently deployed)</li>
  <li>Stores it as <code class="language-plaintext highlighter-rouge">remote_agent</code> for testing</li>
</ol>

<h3 id="42-test-the-deployed-agent">4.2: Test the deployed agent</h3>

<p>Now letâ€™s send a query to your deployed agent!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">remote_agent</span><span class="p">.</span><span class="nf">async_stream_query</span><span class="p">(</span>
    <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">What is the weather in Tokyo?</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">user_id</span><span class="o">=</span><span class="sh">"</span><span class="s">user_42</span><span class="sh">"</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell tests your deployed agent:</p>

<ol>
  <li>Sends the query â€œWhat is the weather in Tokyo?â€</li>
  <li>Streams the response from the agent</li>
</ol>

<p><strong>Understanding the output:</strong></p>

<p>Youâ€™ll see multiple items printed:</p>

<ol>
  <li><strong>Function call</strong> - Agent decides to call <code class="language-plaintext highlighter-rouge">get_weather</code> tool</li>
  <li><strong>Function response</strong> - Result from the tool (weather data)</li>
  <li><strong>Final response</strong> - Agentâ€™s natural language answer</li>
</ol>

<hr />

<h2 id="-section-5-long-term-memory-with-vertex-ai-memory-bank">ğŸ§  Section 5: Long-Term Memory with Vertex AI Memory Bank</h2>

<h3 id="what-problem-does-memory-bank-solve">What Problem Does Memory Bank Solve?</h3>

<p>Your deployed agent has <strong>session memory</strong> - it remembers the conversation while youâ€™re chatting. But once the session ends, it forgets everything. Each new conversation starts from scratch.</p>

<p><strong>The problem:</strong></p>

<ul>
  <li>User tells agent â€œI prefer Celsiusâ€ today</li>
  <li>Tomorrow, user asks about weather â†’ Agent gives Fahrenheit (forgot preference)</li>
  <li>User has to repeat preferences every time</li>
</ul>

<h3 id="-what-is-vertex-ai-memory-bank">ğŸ’¡ What is Vertex AI Memory Bank?</h3>

<p>Memory Bank gives your agent <strong>long-term memory across sessions</strong>:</p>

<table>
  <thead>
    <tr>
      <th>Session Memory</th>
      <th>Memory Bank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Single conversation</td>
      <td>All conversations</td>
    </tr>
    <tr>
      <td>Forgets when session ends</td>
      <td>Remembers permanently</td>
    </tr>
    <tr>
      <td>â€œWhat did I just say?â€</td>
      <td>â€œWhatâ€™s my favorite city?â€</td>
    </tr>
  </tbody>
</table>

<p><strong>How it works:</strong></p>

<ol>
  <li><strong>During conversations</strong> - Agent uses memory tools to search past facts</li>
  <li><strong>After conversations</strong> - Agent Engine extracts key information (â€œUser prefers Celsiusâ€)</li>
  <li><strong>Next session</strong> - Agent automatically recalls and uses that information</li>
</ol>

<p><strong>Example:</strong></p>

<ul>
  <li><strong>Session 1:</strong> User: â€œI prefer Celsiusâ€</li>
  <li><strong>Session 2 (days later):</strong> User: â€œWeather in Tokyo?â€ â†’ Agent responds in Celsius automatically âœ¨</li>
</ul>

<h3 id="-memory-bank--your-deployment">ğŸ”§ Memory Bank &amp; Your Deployment</h3>

<p>Your Agent Engine deployment <strong>provides the infrastructure</strong> for Memory Bank, but itâ€™s not enabled by default.</p>

<p><strong>To use Memory Bank:</strong></p>

<ol>
  <li>Add memory tools to your agent code (<code class="language-plaintext highlighter-rouge">PreloadMemoryTool</code>)</li>
  <li>Add a callback to save conversations to Memory Bank</li>
  <li>Redeploy your agent</li>
</ol>

<p>Once configured, Memory Bank works automatically - no additional infrastructure needed!</p>

<h3 id="-learn-more">ğŸ“š Learn More</h3>

<ul>
  <li><strong><a href="https://google.github.io/adk-docs/sessions/memory/">ADK Memory Guide</a></strong> - Complete guide with code examples</li>
  <li><strong><a href="https://google.github.io/adk-docs/tools/built-in-tools/">Memory Tools</a></strong> - PreloadMemory and LoadMemory documentation</li>
  <li><strong><a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/agents/agent_engine/memory_bank/get_started_with_memory_bank_on_adk.ipynb">Get started with Memory Bank on ADK</a></strong> - Sample notebook that demonstrates how to build ADK agents with memory</li>
</ul>

<hr />

<h2 id="-section-6-cleanup">ğŸ§¹ Section 6: Cleanup</h2>

<p><strong>âš ï¸ IMPORTANT: Prevent unexpected charges: Always delete resources when done testing!</strong></p>

<p><strong>Cost Reminders</strong></p>

<p>As a reminder, leaving the agent running can incur costs. Agent Engine offers a monthly free tier, which you can learn more about in the <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview#pricing">documentation</a>.</p>

<p><strong>Always delete resources when done testing!</strong></p>

<p>When youâ€™re done testing and querying your deployed agent, itâ€™s recommended to delete your remote agent to avoid incurring additional costs:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">agent_engines</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">resource_name</span><span class="o">=</span><span class="n">remote_agent</span><span class="p">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">âœ… Agent successfully deleted</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell deletes your deployed agent:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">resource_name=remote_agent.resource_name</code> - Identifies which agent to delete</li>
  <li><code class="language-plaintext highlighter-rouge">force=True</code> - Forces deletion even if the agent is running</li>
</ul>

<p>The deletion process typically takes 1-2 minutes. You can verify deletion in the <a href="https://console.cloud.google.com/vertex-ai/agents/agent-engines">Agent Engine Console</a>.</p>

<hr />

<h2 id="-congratulations-youre-ready-for-production-deployment">âœ… Congratulations! Youâ€™re Ready for Production Deployment</h2>

<p>Youâ€™ve successfully learned how to deploy ADK agents to Vertex AI Agent Engine - taking your agents from development to production!</p>

<p>You now know how to deploy agents with enterprise-grade infrastructure, manage costs, and test production deployments.</p>

<h3 id="-learn-more-1">ğŸ“š Learn More</h3>

<p>Refer to the following documentation to learn more:</p>

<ul>
  <li><a href="https://google.github.io/adk-docs/">ADK Documentation</a></li>
  <li><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/overview">Agent Engine Documentation</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/agent-engine/">ADK Deployment Guide</a></li>
</ul>

<p><strong>Other Deployment Options:</strong></p>

<ul>
  <li><a href="https://google.github.io/adk-docs/deploy/cloud-run/">Cloud Run Deployment</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/gke/">GKE Deployment</a></li>
</ul>

<p><strong>Production Best Practices:</strong></p>

<ul>
  <li>Delete test deployments when finished to avoid costs</li>
  <li>Enable tracing (<code class="language-plaintext highlighter-rouge">enable_tracing=True</code>) for debugging</li>
  <li>Monitor via <a href="https://console.cloud.google.com/vertex-ai/agents/agent-engines">Vertex AI Console</a></li>
  <li>Follow <a href="https://google.github.io/adk-docs/safety/">security best practices</a></li>
</ul>

<h2 id="-course-recap-your-5-day-journey">ğŸ¯ Course Recap: Your 5-Day Journey</h2>

<p>Over the past 5 days, youâ€™ve learned:</p>

<ul>
  <li><strong>Day 1:</strong> Agent fundamentals - Building your first agent with tools and instructions</li>
  <li><strong>Day 2:</strong> Advanced tools - Custom tools, built-in tools, and best practices</li>
  <li><strong>Day 3:</strong> Sessions &amp; Memory - Managing conversations and long-term knowledge storage</li>
  <li><strong>Day 4:</strong> Observability &amp; Evaluation - Monitoring agents and measuring performance</li>
  <li><strong>Day 5:</strong> Production Deployment - Taking your agents live with Agent Engine</li>
</ul>

<p>You now have the complete toolkit to build, test, and deploy production-ready AI agents!</p>

</article>

      </div>
    </main>
  </body>
</html>

<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="daily.thekingof.cool/feed.xml" rel="self" type="application/atom+xml" /><link href="daily.thekingof.cool/" rel="alternate" type="text/html" /><updated>2026-01-05T10:58:09+08:00</updated><id>daily.thekingof.cool/feed.xml</id><title type="html">thekingofcool’s daily thoughts</title><subtitle>you&apos;re too slow and have no rhythm. 
</subtitle><author><name>thekingofcool</name></author><entry><title type="html">学术论文科普</title><link href="daily.thekingof.cool/agent/2026/01/05/paper.html" rel="alternate" type="text/html" title="学术论文科普" /><published>2026-01-05T00:00:00+08:00</published><updated>2026-01-05T00:00:00+08:00</updated><id>daily.thekingof.cool/agent/2026/01/05/paper</id><content type="html" xml:base="daily.thekingof.cool/agent/2026/01/05/paper.html"><![CDATA[<p>你是一位顶尖的科普作家和知识转述者，被誉为“最会搭梯子的人”。你的专长是将那些充斥着术语、数据和复杂模型的学术论文，转译（Reframe）成普通大众能轻松读懂、产生共鸣并深受启发的科普文章。</p>

<p>你的使命不是“翻译”论文，而是“重建”理解。你为读者搭建一座从“一无所知”到“原来如此”的桥梁，让他们在零负担的阅读中，领略到科学研究的真正魅力、核心发现及其对现实世界的意义。</p>

<hr />

<p>工作流程：从论文到科普的“阶梯搭建”</p>

<p>当你收到一篇需要进行科普解读的学术论文时，你将严格遵循以下步骤：</p>

<ul>
  <li>
    <p>第一步：挖掘“人”与“动机” (The “Who” and “Why”)</p>

    <ul>
      <li>在深入论文细节前，先检索作者及其所属机构的背景。</li>
      <li>尝试建立一个有趣的联系：为什么是“他们”在研究“这个”问题？
（例如：这个实验室是否一直在该领域深耕？他们是不是“跨界”解决了一个老问题？或者这个机构的使命是否与此相关？）</li>
      <li>【应用规则】：如果背景故事（如作者的“执念”或机构的“使命”）能让研究动机更生动，就在文章中巧妙融入。
如果联系牵强，则不必在正文中提及，避免生硬介绍。</li>
    </ul>
  </li>
  <li>
    <p>第二步：钻研与消化 (Digest and Understand)</p>

    <ul>
      <li>
        <p>深入阅读论文，彻底拆解其核心三要素：</p>

        <ol>
          <li>研究问题 (The Question)：他们到底想解决什么谜题？这个问题的背景和重要性是什么？</li>
          <li>研究方法 (The How)：他们是怎么找到答案的？（重点理解其思路，而非复述技术细节）</li>
          <li>核心发现 (The Finding)：他们最终发现了什么？这个发现有多“反直觉”或多“重要”？</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>
    <p>第三步：定位“行业坐标”与“Aha!时刻” (Locate its Position and the “Aha! Moment”)</p>

    <ul>
      <li>（必要时使用工具检索）结合业界或学术界的现状来分析这篇论文。</li>
      <li>它在整个领域中扮演了什么角色？是解决了同行一个“老大难”的痛点？是推翻了一个旧认知？还是开辟了一个全新的赛道？</li>
      <li>提炼“故事线”：将论文的“论证逻辑”转化为“叙事逻辑”。
找到论文中最激动人心的“Aha!”时刻，并明确这篇科普文章的核心“卖点”（Takeaway）——读者读完后，能带走的那个最清晰、最有价值的知识点。</li>
    </ul>
  </li>
  <li>
    <p>第四步：撰写科普博文 (Compose the Pop-Science Blog)</p>

    <ul>
      <li>完全代入下方定义的“角色定位”与“写作风格”，撰写一篇独立、完整、引人入胜的科普解读。</li>
      <li>注意：篇幅长度不限，以“把普通人彻底讲明白”为唯一标准。</li>
      <li>确保在“所以呢？” (The “So What?”) 部分，有力地传达出它对行业或普通人的真正影响（基于第三步的分析）。</li>
    </ul>
  </li>
</ul>

<hr />

<p>读者与风格</p>

<ul>
  <li>目标读者：对世界充满好奇的普通大众。他们没有专业背景，渴望理解新知识，但对术语和公式天然“过敏”。他们阅读的目的是获取新知、满足好奇心和“哇塞”的瞬间。</li>
  <li>
    <p>写作风格：</p>

    <ul>
      <li>极致通俗 (Radical Accessibility)：比喻是你的第一语言。能用“厨房里的化学反应”解释的，绝不用“非对映选择性”。如果必须使用术语，必须立刻用一个生动的类比将其“翻译”掉。</li>
      <li>故事为王 (Storytelling)：把研究过程讲成一个“破案故事”或“探险之旅”。科学家是主角，他们面临一个难题，设计了一个聪明的“陷阱”（实验），最后抓住了“真相”（结论）。</li>
      <li>聚焦“所以呢？” (The “So What?”)：时刻帮读者回答这个问题。这个研究跟我有什么关系？它为什么重要？它可能如何改变我们的生活或认知？</li>
      <li>简化而不歪曲 (Simplify, Don’t Misrepresent)：这是科普的底线。在简化复杂概念时，保持核心事实的准确性。清晰地区分“已证实的”和“推测的”。</li>
    </ul>
  </li>
</ul>

<hr />

<p>写作思路与技巧（供自由使用）</p>

<ul>
  <li>
    <p>开篇点题，建立框架：</p>

    <ul>
      <li>可以用一个生动的问题、反直觉的观察或核心冲突来引入主题，快速帮读者定位。</li>
      <li>也可以先用简洁的语言勾勒出原文要解决的核心问题或讨论范围。</li>
    </ul>
  </li>
  <li>
    <p>结构化梳理，逐层解析：</p>

    <ul>
      <li>善用小标题或清晰的段落划分，引导读者逐步理解。</li>
      <li>在转述原文观点时，无缝融入类比，让复杂的点变得具体可感。（例如：“作者提到的‘异步通信’，你就可以理解为发邮件，而不是打电话。”）</li>
    </ul>
  </li>
  <li>
    <p>聚焦重点，详略得当：</p>

    <ul>
      <li>明确区分主干与枝叶。重点阐释核心观点与关键逻辑，简略带过次要信息。</li>
      <li>确保读者高效抓住重点。</li>
    </ul>
  </li>
  <li>
    <p>巧妙融入背景：</p>

    <ul>
      <li>如果原文涉及人物或机构背景，自然融入解读，帮助读者理解“为什么”或“此刻的重要性”，避免生硬介绍。</li>
    </ul>
  </li>
  <li>
    <p>结尾总结，提供价值：</p>

    <ul>
      <li>清晰提炼原文核心价值，或指出其当下意义。</li>
      <li>给读者一个明确的Takeaway，让他们确实学到东西，理解原文。</li>
    </ul>
  </li>
</ul>

<hr />

<p>禁止出现的表达方式</p>

<ul>
  <li>避免生硬的引导语，如“本文研究了……”、“该论文的作者发现……”、“实验结果表明……”。</li>
  <li>严禁直接复制论文摘要或引言中的学术黑话。</li>
  <li>避免罗列枯燥数据或统计指标（如p值、置信区间），除非能转译为“有多大把握”或“效果有多明显”。</li>
</ul>

<hr />

<p>核心目标</p>

<p>你的文字是读者通往科学殿堂的“快速通道”和“专属翻译器”。
你必须用最大的真诚和智慧，将学术的“硬核”包裹在通俗、有趣、有故事性的“糖衣”里，让读者在愉快的阅读中，毫不费力地吸收最前沿的知识精髓。</p>]]></content><author><name>thekingofcool</name></author><category term="agent" /><summary type="html"><![CDATA[你是一位顶尖的科普作家和知识转述者，被誉为“最会搭梯子的人”。你的专长是将那些充斥着术语、数据和复杂模型的学术论文，转译（Reframe）成普通大众能轻松读懂、产生共鸣并深受启发的科普文章。]]></summary></entry><entry><title type="html">任务完成清单</title><link href="daily.thekingof.cool/tada/2026/01/05/append-and-review.html" rel="alternate" type="text/html" title="任务完成清单" /><published>2026-01-05T00:00:00+08:00</published><updated>2026-01-05T00:00:00+08:00</updated><id>daily.thekingof.cool/tada/2026/01/05/append-and-review</id><content type="html" xml:base="daily.thekingof.cool/tada/2026/01/05/append-and-review.html"><![CDATA[<p>TODO for today:</p>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />training for war</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />setup tada list pattern</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />setup general agents</li>
</ul>

<hr />

<p>思考如何阅读一本书，最高效吸收其中的思想，用自己的文字表达</p>

<p>波段swing trade 操作不是不可，首先要选好的长期向上的标的，感受波涛的律动时讲究：</p>

<p>学会看图形，但不以它为主要依据；
并且（无论方向）分批，缓进，进之越深，抄之越多。</p>

<p>0 0 -100 -200 -500 0 0 +100 +200 +500</p>

<p>学习常用的 K 线形态，用来作为判断的验证方式</p>

<p>财不入急门。</p>

<p>永远不将未来押注于运气或虚无缥缈之事，接受一切自己判断带来的结果，accept it，达之穷之皆因我，我只是做自己的观察，做自己的判断。</p>]]></content><author><name>thekingofcool</name></author><category term="tada" /><summary type="html"><![CDATA[TODO for today:]]></summary></entry><entry><title type="html">真本事</title><link href="daily.thekingof.cool/thoughts/2026/01/04/true-power.html" rel="alternate" type="text/html" title="真本事" /><published>2026-01-04T00:00:00+08:00</published><updated>2026-01-04T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2026/01/04/true-power</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2026/01/04/true-power.html"><![CDATA[<p>昨天，委内瑞拉总统和他夫人被美国三角洲部队捕获带到美国，预计将在纽约接受审判。整个行动计划了数月，任务执行过程不到 90 分钟，没有一个美国士兵丧生。</p>

<p>这是美国秀肌肉的方式，没有海报、没有宣传，只有行动。这也是科技发展对人类进步的体现之一，对强权政治国家的元首实行精准打击，没有一个平民受到影响，他们唯一的感受就是早上一起床，国内的独裁者已经被带到监狱。</p>

<p>讽刺的是在军事行动前当天，中国特使还和马杜罗进行了会面，上个月中国各个渠道也释放出给委内瑞拉提供保障的信息。独裁政权历来习惯夸大自身的影响力，骗别人久了自己也不自主地跟着相信，丝毫不会在意外界发生的变化。</p>

<p>近期伊朗国内同样面临着严重的内部压力，由于经济问题导致汇率崩盘，物价飙升，经济活动一片混乱，各地都爆发激烈地呼吁民主的声音。尽管独裁者都一致通过控制着新闻喉舌，自诩代表着人民的声音，但人心向背无法被杜撰。</p>

<p>由此联想前期日本首相高市早苗的台湾有事就是日本有事的言论，应该也和美国的默许甚至是指示不无关系。伊朗和委内瑞拉的石油大量出口至中国，委甚至达到 80 % 的出口总量，这个国家同时还欠着中国 650 亿美元的债务，看起来有人在下一盘大棋。</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[昨天，委内瑞拉总统和他夫人被美国三角洲部队捕获带到美国，预计将在纽约接受审判。整个行动计划了数月，任务执行过程不到 90 分钟，没有一个美国士兵丧生。]]></summary></entry><entry><title type="html">关于现金流的思考</title><link href="daily.thekingof.cool/thoughts/2025/12/16/thoughts-on-cash-flow.html" rel="alternate" type="text/html" title="关于现金流的思考" /><published>2025-12-16T00:00:00+08:00</published><updated>2025-12-16T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/12/16/thoughts-on-cash-flow</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/12/16/thoughts-on-cash-flow.html"><![CDATA[<p>离职已两个半月，投资股市有了一定的未实现收益。但是这不是长远之计，首先缺少现金流的支持，生活方式被动陷入收缩，一些想做的事情也变得捉襟见肘；另外日常就空出了大段的时间，短期体会了闲暇的滋味也变得没多少乐趣。</p>

<p>关于现金流，首先这是个必须，产生它的方式有以下几种，最直接就是继续参加工作，鉴于我的认知感受，排除这种低调获得劳动报酬的方式；尝试过借出股票获得利息的形式，由于所选标目前低交易量的现状，没有多少借出需求，作罢；还有一个引入一些风险因素的方式，拿出一部分资金用于期权投资或者波段交易，这两种都会有一些压力接入。期权投资我可以模拟账号试着学一学基本概念，暂时按下不题。</p>

<p>波段交易存在风险，但这风险不是不能降低，最关键的一部份是选择合适的标的，Unity 这支股票实际是适合做波段的，正处在长期上行趋势中，现阶段看不到别的可能；波动大，受众小，基本面上还不足以支撑真正爆发；在价值被主流市场接受之前，其实是存在大量的波段套利空间。</p>

<p>重要的就是在情绪影响使股价大幅偏离基本面时卖出部分股票，市场纠偏过程中又买回，这个操作要想成功（特别是如果需要多次）要求很高，你要很清楚现在以及即将发生的事，同时又足够冷静置身事外，足够上心你能感同身受市场中各方的感受。即使做到了上面的所有，风险仍然存在，剩下的就是命。强大到这些都不会影响你的正常生活和作息。</p>

<p>波段操作我愿比之为刀尖舔血，真正的价值投资者会尽可能少的进行这类交易行为。充分利用自己的优势减少潜在风险，这是我在当下能想到的最佳路径了。</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[离职已两个半月，投资股市有了一定的未实现收益。但是这不是长远之计，首先缺少现金流的支持，生活方式被动陷入收缩，一些想做的事情也变得捉襟见肘；另外日常就空出了大段的时间，短期体会了闲暇的滋味也变得没多少乐趣。]]></summary></entry><entry><title type="html">Before the Santa Rally</title><link href="daily.thekingof.cool/thoughts/2025/12/13/before-the-santa-rally.html" rel="alternate" type="text/html" title="Before the Santa Rally" /><published>2025-12-13T00:00:00+08:00</published><updated>2025-12-13T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/12/13/before-the-santa-rally</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/12/13/before-the-santa-rally.html"><![CDATA[<p>这周三美联储利率决议降息了25个基点，并开启了短债回购给市场注入流动性，以应对日本加息预期对美国金融稳定性的冲击。</p>

<p>本来这对股市是一个提振，但周三周四甲骨文、博通财报陆续推出，AI算力建设投资回报不及市场预期，由此引发投资人对人工智能投资是否能得到合理回报的担忧，华尔街的预期管理大师们以此为由制造了科技股的抛售潮。</p>

<p>周五纳斯达克跌近2%，Unity 跌超 6%，好消息是在此之前两家评级机构接连调整 Unity 股票评级，目标价分别调整到 59 或 60 美元，Unity 在周中创下了 52 周新高，触及 52 美元上方，本周收在 46.16。</p>

<p>整体来看不论宏观还是 Unity 公司基本面都很健康，下周过后就进入圣诞假期，在圣诞行情前回撤股市才有充足的动力向上突破。</p>

<p>enjoy the ride</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[这周三美联储利率决议降息了25个基点，并开启了短债回购给市场注入流动性，以应对日本加息预期对美国金融稳定性的冲击。]]></summary></entry><entry><title type="html">贸易顺差首次突破1万亿美元</title><link href="daily.thekingof.cool/thoughts/2025/12/09/trade-surplus.html" rel="alternate" type="text/html" title="贸易顺差首次突破1万亿美元" /><published>2025-12-09T00:00:00+08:00</published><updated>2025-12-09T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/12/09/trade-surplus</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/12/09/trade-surplus.html"><![CDATA[<p>看到一则消息，中国今年前 11 个月累计贸易顺差突破 1 万亿，打破历史记录。今天分析一下为什么会这样，以及推演潜在的路径和对投资人的影响。</p>

<p>尽管今年有中美贸易战影响，中国贸易顺差持续扩大原因在于中国政府对汇率的控制。疫情以来，人民币对美元汇率从 6.3 附近持续贬值，已经很长一段时间稳在 7.1 到 7.3，近期美国降息给人民币带来升值压力，目前也维持在 7.07 附近。</p>

<p>按照平价购买力理论，也就是以相同商品在不同国家的价格来决定相对汇率水平，那么人民币还有巨大的升值空间（30%乃至更高）。中国政府凭借手中充足的外汇储备（3.5 万亿美元）和政策手段（设置每日汇率中间价，正负 2% 浮动区间）稳定汇率市场。</p>

<p>那么不让人民币自由升值的目的是什么？答案是保出口、保就业、维持社会稳定。</p>

<p>中国目前是出口导向型经济，GDP 中 30% 都是由出口拉动，其制造业影响 1～2 亿人就业。保持出口商品的竞争力，直接关乎社会稳定。代价就是国内消费不振，长期陷入通缩。</p>

<p>让人民币缓慢升值的好处则是，降低进口商品价格，人们有更多结余而提升消费市场活力（存疑，因为这关乎社会信心），但代价是挤压国内商家利润，同时降低出口商品的国际竞争力，增加失业率，减缓 GDP 增长。在国际上减少了对其他国家市场的压力，减少关税和贸易保护。</p>

<p>经济学家们普遍认为让货币自由升值有助于发展健康的国内经济和国际贸易环境，但也看政府能不能承受出口动能减弱带来的短时间失业压力。</p>

<p>我的看法是，尽管人民币存在升值压力，但中国政府还是会选择维持当前状态尽可能长的时间，因为他们执政的首要目的不再是提升经济发展程度和人民生活水平，而是维持社会稳定和统治牢固。</p>

<hr />

<p>Unity 昨天突破了近三年的压力位，站上 49 美元上方。看到 Reddit 里面有人讨论 2022 年对 IronSource 的收购对于 Unity 来说是否是一剂毒药。因为我关注到 Unity 已经是 2024 上半年，公司正处于管理层变动和组织架构调整期，没有经历前面大规模并购和 runtime fee 风波。</p>

<p>早期 Unity 因为元宇宙火热而成为资本关注的焦点，时任 CEO 手捧热钱一心想着扩大公司版图，一路并购。当时公司的主要利润来源也是来自于游戏广告，可后来 Apple 更新了平台隐私条款，导致 Unity 自有的广告模式效果不佳，当时市场也出来了借机器学习撮合广告投放的新形式，最出众的就是 APPLovin 和 IronSource，当时的管理层选择以股票的形式收购 IronSource，合并后的公司 IS 占比 24% 左右。但业务整合却不太顺利，据 Unity 前员工说，IS 的人几乎不配合工作，前高管还持续不断卖股票。为了挽救公司的收益，当时的 CEO 推出了充满争议的 runtime fee，根据开发者制作应用的下载量进行收费，迎来一片抵制，由此股价一路下挫，公司 CEO 也不得不辞职。</p>

<p>后面的故事就是全新的管理层接管，随即取消了 runtime fee 政策，关闭非核心业务，推出新的 Unity 6 引擎，自研基于机器学习的 Vector AI 广告平台，发布免费的 Ad Quality 组件，推出 In App Purchase SDK 让游戏开发者自行管理游戏资产收益避免高额平台过路费，和 EpicGames 合作，在通过 Grow 业务保持公司利润和现金流的同时为游戏生态考虑不断优化核心产品，并且积极布局未来，在 VR 、工业、小游戏、网页游戏、车机交互系统等多个领域同时发力，带来了公司估值的回升，谱写一个经典的困境反转故事。</p>

<p>这样说的话，还得感谢之前那个我也没记过名字的 CEO，为 Unity 制造了一个危机，让我能够接触到这家公司以及在一个极低的位置建仓完成。</p>

<p>今晚估计大概率还是延续昨天的势头，50 is the new 30，就像之前我曾说的 30 is the new 20。短期不用再看了，研究研究市场整体宏观，和各板块趋势，调查新的机会吧。</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[看到一则消息，中国今年前 11 个月累计贸易顺差突破 1 万亿，打破历史记录。今天分析一下为什么会这样，以及推演潜在的路径和对投资人的影响。]]></summary></entry><entry><title type="html">文革 2.0？</title><link href="daily.thekingof.cool/thoughts/2025/12/08/cultural-revolution.html" rel="alternate" type="text/html" title="文革 2.0？" /><published>2025-12-08T00:00:00+08:00</published><updated>2025-12-08T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/12/08/cultural-revolution</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/12/08/cultural-revolution.html"><![CDATA[<p>最近几天大家聊的最多的就是文革 2.0 风险，B 站一个解说电影芳华的视频播放量达 3500 万后被下架，引发众多网友怀念文革。昨天甚至有学生约定 12 月 8 日 在南昌八一广场集会宣传禁毒，目前其附近已实行交通管制，广场上警察早已就位，学校也宣布所有宿舍点名不许外出。</p>

<p>这片土地拥有丰厚的文革土壤，归根结底是制度层面留了太多灰色空间，利用愚民政策为既得利益群体攫取源源不断的好处。自秦制以来同样的执政 playbook 一次又一次循环，屠龙者不断变成巨龙，苦难则一直萦绕在国土上空。</p>

<p>至于普通人的应对措施，首先得拥有力量，物理和文化上的。物理力量要足以保护自己和自己关心的人，文化力量则让自己可以随机应变，打入各方内部，及时了解局势全貌。另外就是尽可能低调，不管在哪一边，局势不明朗之前不轻易冒进，随时处在进可攻退可守状态。</p>

<p>目前执政机器庞大且迟钝，看似坚硬实际极易脆断。整体经济缺乏活力，远远没有充分就业。牌桌上又充斥着不公：医疗养老双轨，土地财政难以为继。发展过程中政府过于压榨，社会未富经济先失速。年轻人看不到希望，而庙堂的谎言编织水平几十年未变，早已跟不上时代。若非主动进行政治体制改革，巨变也许等不了太久。</p>

<hr />

<p>昨天和我弟聊了关于投资，他问我核心 + 卫星的投资组合是不是更好，我说每个人基于自己的经验和风险承受度找到自己最舒适的投资风格就是最好的。</p>

<p>投资这种事本就因人而异，他人的投资策略不见得适用于自己的资金规模，也不一定能得到彻底地执行。市场上主流的策略是分散投资，但我个人对它的看法是，这个策略的执行人要么是资金量足够大，规避风险成了他的第一优先级，要么他对所投的每一个标的都不够了解，以至于无法准确判断风险只能做保守判断。</p>

<p>投资的核心在于以一个相对低的价格买入高价值、未来高增长的资产，尽管看起来简单，实际做到却并不容易，判断高价值和高增长要求投资者对世界、周遭、企业和人性具有深刻认识，而纷繁复杂的网络资讯又充满了噪音。当抓住所有有效信息做到了以上一切，你还需要一点运气才能实现回报。</p>

<p>所以在这个过程中，良好的心态甚至良好的身体都是必不可少的条件。</p>

<p>市场上可交易的资产种类纷繁复杂，可本质都一样，你需要足够了解你所投的每一项标的，这种情况下即使判断失误也能忍赌服输，然后从中学到必要的知识，如此反复迭代，让自己的投资风格更健全，最理想的情况是在投资早期花尽可能少量的学费建立起坚固的投资护城河。</p>

<hr />

<p>关于经济，当前主要焦点在周三的美联储利率决议会议，市场预期本次次降息 25 个基点。目前炒作的板块已经逐渐从英伟达、AMD 这类算力股转向 Google 等应用层，前不久 Google 推出的 Gemini 3 表现超出 GPT 5，加上自制 TPU 芯片及搜索等应用场景的叠加，把公司股价推到聚光灯下。近期将发布 Android XR 新特性，结合与三星合作的头显及智能眼镜。</p>

<p>Netflix 收购华纳兄弟影视，联想前不久 EA 被收购，影视/游戏产业接连被资本提前布局。随着技术的迭代，线上娱乐领域或许将迎来全新的互动体验形式，AI应用层，效果以及动力最强的应该也就这两个板块。最好情况下，在算力过剩/泡沫出现之前，应用层出现改变人们生活方式的形式，为企业带来真实的业绩支撑。</p>

<p>总结一下近期 Unity 的动态，三季度财报超预期；推出跨平台 IAP 组件；与 Epic Games 合作，将 Unity 的游戏注入 Fortnight 世界，打开新的受众世界；Unity game in Reddit，类似于小游戏，便于游戏分发、试玩、获得反馈；与 Walmart 合作强化广告生态健壮性。</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[最近几天大家聊的最多的就是文革 2.0 风险，B 站一个解说电影芳华的视频播放量达 3500 万后被下架，引发众多网友怀念文革。昨天甚至有学生约定 12 月 8 日 在南昌八一广场集会宣传禁毒，目前其附近已实行交通管制，广场上警察早已就位，学校也宣布所有宿舍点名不许外出。]]></summary></entry><entry><title type="html">信息互通</title><link href="daily.thekingof.cool/thoughts/2025/12/05/transparency.html" rel="alternate" type="text/html" title="信息互通" /><published>2025-12-05T00:00:00+08:00</published><updated>2025-12-05T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/12/05/transparency</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/12/05/transparency.html"><![CDATA[<p>最近 unity 回到了 44 水平，对于这样一支高波动股票，每日涨跌 5% 以内都没有太大意义。降低对股市每日波动的关注度，让时间过的有价值。</p>

<p>现在政府政策昏招频出，日本歌手滨崎步上海演出极限被取消，取消后对着14000空座位完整演出，当局却说这是彩排，抓了个中方摄影师来道歉；全面替代新国标电动自行车，速度承载都加了限制，顺便提升了价格，这种开倒车降低体验的事情但得到了官方的支持，也许又是哪个红色公子在努力创业呢。</p>

<p>最近和老婆快把绝命毒师看完了，偶尔玩两把空洞骑士、海岛奇兵，最近还打算把经济学原理以及历代中国的政治得失，还有毛泽东选集中自己感兴趣的部分看了，了解微观经济、身边的历史。</p>

<p>今天试着把家里重要的资料数字化，并考虑灾备进行加密备份存储。下一步我想尽快把身边的事物整理一遍，形成家庭紧急背包一个，应急生存物资清单、应急药物清单、应急武器清单，分布式多点布设储备并及时更新。</p>

<p>家人的健康是重中之重，监督他们养成自身习惯的健康生活方式。</p>

<p>在当下时代，要最大程度保全自己，同时准备好退路，和重要的人保持信息高度互通。</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[最近 unity 回到了 44 水平，对于这样一支高波动股票，每日涨跌 5% 以内都没有太大意义。降低对股市每日波动的关注度，让时间过的有价值。]]></summary></entry><entry><title type="html">Day 5b - Agent Deployment</title><link href="daily.thekingof.cool/thoughts/2025/11/14/day-5b-agent-deployment.html" rel="alternate" type="text/html" title="Day 5b - Agent Deployment" /><published>2025-11-14T00:00:00+08:00</published><updated>2025-11-14T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/11/14/day-5b-agent-deployment</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/11/14/day-5b-agent-deployment.html"><![CDATA[<h1 id="-deploy-adk-agent-to-vertex-ai-agent-engine">🚀 Deploy ADK Agent to Vertex AI Agent Engine</h1>

<p><strong>Welcome to the final day of the Kaggle 5-day Agents course!</strong></p>

<p>In the previous notebook you learned how to use Agent2Agent Protocol to make your agents interoperable.</p>

<p>Now, let’s take the final step: deploying your agents to production using <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview">Vertex AI Agent Engine</a>.</p>

<h2 id="-scaling-your-agent">💡 Scaling Your Agent</h2>

<p>You’ve built an amazing AI agent. It works perfectly on your machine. You can chat with it, it responds intelligently, and everything seems ready. But there’s a problem.</p>

<blockquote>
  <p><strong>Your agent is not publicly available!</strong></p>
</blockquote>

<p>It only lives in your notebook and development environment. When you stop your notebook session, it stops working. Your teammates can’t access it. Your users can’t interact with it. And this is precisely why we need to deploy the agents!</p>

<h2 id="-what-youll-learn">🎯 What You’ll Learn</h2>

<p>In this notebook, you’ll:</p>

<ul>
  <li>✅ Build a production-ready ADK agent</li>
  <li>✅ Deploy your agent to <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview"><strong>Vertex AI Agent Engine</strong></a> using the ADK CLI</li>
  <li>✅ Test your deployed agent with Python SDK</li>
  <li>✅ Monitor and manage deployed agents in Google Cloud Console</li>
  <li>✅ Understand how to add Memory to your Agent using Vertex AI Memory Bank</li>
  <li>✅ Understand cost management and cleanup best practices</li>
</ul>

<h2 id="️-section-1-setup">⚙️ Section 1: Setup</h2>

<h3 id="11-️-important-prerequisites">1.1: ⚠️ <strong>Important: Prerequisites</strong></h3>

<p>This notebook requires a <strong>Google Cloud Platform (GCP) account</strong> to deploy agents to Vertex AI Agent Engine.</p>

<p><strong>If you don’t have a GCP account yet:</strong></p>

<p>✅ Step 1. <strong>Create a free Google Cloud account</strong> - <a href="https://cloud.google.com/free">Sign up here</a></p>
<ul>
  <li>New users get <strong>$300 in free credits</strong> valid for 90 days</li>
  <li>No charges during the free trial period</li>
</ul>

<p>✅ Step 2. <strong>Enable billing on your account</strong> - Required even for free tier</p>
<ul>
  <li>A credit card is needed for verification</li>
  <li>You won’t be charged unless you explicitly upgrade</li>
  <li>This demo stays within the free tier if you clean up resources promptly</li>
</ul>

<p>✅ Step 3. <strong>Understand the free tier</strong> - Know what’s included</p>
<ul>
  <li>Deploy up to 10 agents at no cost</li>
  <li>Check <a href="https://cloud.google.com/free/docs/free-cloud-features#free-trial">free tier details</a></li>
  <li>Review <a href="https://cloud.google.com/signup-faqs?hl=en#google-cloud-free-trial-faqs">common questions</a></li>
</ul>

<p><strong>💡 Quick Setup Guide:</strong> Watch this <a href="https://youtu.be/-nUAQq_evxc">3-minute setup video</a> for a walkthrough</p>

<h3 id="12-import-components">1.2: Import components</h3>

<p>Now, import the specific components you’ll need for this notebook. This keeps your code organized and ensures we have access to the necessary building blocks.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">vertexai</span>
<span class="kn">from</span> <span class="n">kaggle_secrets</span> <span class="kn">import</span> <span class="n">UserSecretsClient</span>
<span class="kn">from</span> <span class="n">vertexai</span> <span class="kn">import</span> <span class="n">agent_engines</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Imports completed successfully</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Imports completed successfully
</code></pre></div></div>

<h3 id="13-add-cloud-credentials-to-secrets">1.3: Add Cloud Credentials to Secrets</h3>

<ol>
  <li>In the top menu bar of the notebook editor, select <code class="language-plaintext highlighter-rouge">Add-ons</code> then <code class="language-plaintext highlighter-rouge">Google Cloud SDK</code>.</li>
  <li>Click on <code class="language-plaintext highlighter-rouge">Link Account</code></li>
  <li>Select your Google Cloud Account</li>
  <li>Attach to the notebook</li>
</ol>

<p>This cell retrieves your Google Cloud credentials from Kaggle Secrets and configures them for use. These credentials allow the notebook to authenticate with Google Cloud services like Vertex AI Agent Engine.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set up Cloud Credentials in Kaggle
</span><span class="n">user_secrets</span> <span class="o">=</span> <span class="nc">UserSecretsClient</span><span class="p">()</span>
<span class="n">user_credential</span> <span class="o">=</span> <span class="n">user_secrets</span><span class="p">.</span><span class="nf">get_gcloud_credential</span><span class="p">()</span>
<span class="n">user_secrets</span><span class="p">.</span><span class="nf">set_tensorflow_credential</span><span class="p">(</span><span class="n">user_credential</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Cloud credentials configured</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Cloud credentials configured
</code></pre></div></div>

<h3 id="14-set-your-project_id">1.4: Set your PROJECT_ID</h3>

<p><strong>Important:</strong> Make sure to replace <code class="language-plaintext highlighter-rouge">"your-project-id"</code> with your actual Google Cloud project ID. You can find your project ID in the <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Set your PROJECT_ID
</span><span class="n">PROJECT_ID</span> <span class="o">=</span> <span class="sh">"</span><span class="s">gen-lang-client-0294379375</span><span class="sh">"</span>  <span class="c1"># TODO: Replace with your project ID
</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_PROJECT</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">PROJECT_ID</span>

<span class="k">if</span> <span class="n">PROJECT_ID</span> <span class="o">==</span> <span class="sh">"</span><span class="s">your-project-id</span><span class="sh">"</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">PROJECT_ID</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">⚠️ Please replace </span><span class="sh">'</span><span class="s">your-project-id</span><span class="sh">'</span><span class="s"> with your actual Google Cloud Project ID.</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">✅ Project ID set to: </span><span class="si">{</span><span class="n">PROJECT_ID</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Project ID set to: gen-lang-client-0294379375
</code></pre></div></div>

<h3 id="15-enable-google-cloud-apis">1.5: Enable Google Cloud APIs</h3>

<p>For this tutorial, you’ll need to enable the following APIs in the Google Cloud Console.</p>

<ul>
  <li>Vertex AI API</li>
  <li>Cloud Storage API</li>
  <li>Cloud Logging API</li>
  <li>Cloud Monitoring API</li>
  <li>Cloud Trace API</li>
  <li>Telemetry API</li>
</ul>

<p>You can <a href="https://console.cloud.google.com/flows/enableapi?apiid=aiplatform.googleapis.com,storage.googleapis.com,logging.googleapis.com,monitoring.googleapis.com,cloudtrace.googleapis.com,telemetry.googleapis.com">use this link to open the Google Cloud Console</a> and follow the steps there to enable these APIs.</p>

<hr />

<h2 id="️-section-2-create-your-agent-with-adk">🏗️ Section 2: Create Your Agent with ADK</h2>

<p>Before we deploy, we need a functional agent to host. We’ll build a <strong>Weather Assistant</strong> designed to serve as our sample agent.</p>

<p>This agent is optimized for production testing with the following configuration:</p>

<ul>
  <li><strong>Model:</strong> Uses gemini-2.5-flash-lite for low latency and cost-efficiency.</li>
  <li><strong>Tools:</strong> Includes a <code class="language-plaintext highlighter-rouge">get_weather</code> function to demonstrate tool execution.</li>
  <li><strong>Persona:</strong> Responds conversationally to prove the instruction-following capabilities.</li>
</ul>

<p>This demonstrates the foundational ADK architecture we are about to package: <strong>Agent + Tools + Instructions</strong>.</p>

<p>We’ll create the following files and directory structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sample_agent/
├── agent.py                  # The logic
├── requirements.txt          # The libraries
├── .env                      # The secrets/config
└── .agent_engine_config.json # The hardware specs
</code></pre></div></div>

<h3 id="21-create-agent-directory">2.1: Create agent directory</h3>

<p>We need a clean workspace to package our agent for deployment. We will create a directory named <code class="language-plaintext highlighter-rouge">sample_agent</code>.</p>

<p>All necessary files - including the agent code, dependencies, and configuration—will be written into this folder to prepare it for the <code class="language-plaintext highlighter-rouge">adk deploy</code> command.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Create simple agent - all code for the agent will live in this directory
</span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">sample_agent</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">✅ Sample Agent directory created</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Sample Agent directory created
</code></pre></div></div>

<h3 id="22-create-requirements-file">2.2: Create requirements file</h3>

<p>The Agent Engine builds a dedicated environment for your agent. To ensure it runs correctly, we must declare our dependencies.</p>

<p>We will write a <code class="language-plaintext highlighter-rouge">requirements.txt</code> file containing the Python packages needed for the agent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="n">requirements</span><span class="p">.</span><span class="n">txt</span>

<span class="n">google</span><span class="o">-</span><span class="n">adk</span>
<span class="n">opentelemetry</span><span class="o">-</span><span class="n">instrumentation</span><span class="o">-</span><span class="n">google</span><span class="o">-</span><span class="n">genai</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/requirements.txt
</code></pre></div></div>

<h3 id="23-create-environment-configuration">2.3: Create environment configuration</h3>

<p>We need to provide the agent with the necessary cloud configuration settings.</p>

<p>We will write a <code class="language-plaintext highlighter-rouge">.env</code> file that sets the cloud location to <code class="language-plaintext highlighter-rouge">global</code> and explicitly enables the Vertex AI backend for the ADK SDK.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">env</span>

<span class="c1"># https://cloud.google.com/vertex-ai/generative-ai/docs/learn/locations#global-endpoint
</span><span class="n">GOOGLE_CLOUD_LOCATION</span><span class="o">=</span><span class="sh">"</span><span class="s">global</span><span class="sh">"</span>

<span class="c1"># Set to 1 to use Vertex AI, or 0 to use Google AI Studio
</span><span class="n">GOOGLE_GENAI_USE_VERTEXAI</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/.env
</code></pre></div></div>

<p><strong>Configuration explained:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GOOGLE_CLOUD_LOCATION="global"</code> - Uses the <code class="language-plaintext highlighter-rouge">global</code> endpoint for Gemini API calls</li>
  <li><code class="language-plaintext highlighter-rouge">GOOGLE_GENAI_USE_VERTEXAI=1</code> - Configures ADK to use Vertex AI instead of Google AI Studio</li>
</ul>

<h3 id="24-create-agent-code">2.4: Create agent code</h3>

<p>We will now generate the <code class="language-plaintext highlighter-rouge">agent.py</code> file. This script defines the behavior of our <strong>Weather Assistant</strong>.</p>

<p>Agent Configuration:</p>

<ul>
  <li>🧠 Model: Uses <code class="language-plaintext highlighter-rouge">gemini-2.5-flash-lite</code> for low latency and cost-efficiency.</li>
  <li>🛠️ Tools: Accesses a <code class="language-plaintext highlighter-rouge">get_weather</code> function to retrieve data.</li>
  <li>📝 Instructions: Follows a system prompt to identify cities and respond in a friendly tone.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="n">agent</span><span class="p">.</span><span class="n">py</span>
<span class="kn">from</span> <span class="n">google.adk.agents</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">import</span> <span class="n">vertexai</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="n">vertexai</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span>
    <span class="n">project</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_PROJECT</span><span class="sh">"</span><span class="p">],</span>
    <span class="n">location</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_CLOUD_LOCATION</span><span class="sh">"</span><span class="p">],</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">get_weather</span><span class="p">(</span><span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Returns weather information for a given city.

    This is a TOOL that the agent can call when users ask about weather.
    In production, this would call a real weather API (e.g., OpenWeatherMap).
    For this demo, we use mock data.

    Args:
        city: Name of the city (e.g., </span><span class="sh">"</span><span class="s">Tokyo</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">New York</span><span class="sh">"</span><span class="s">)

    Returns:
        dict: Dictionary with status and weather report or error message
    </span><span class="sh">"""</span>
    <span class="c1"># Mock weather database with structured responses
</span>    <span class="n">weather_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">san francisco</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in San Francisco is sunny with a temperature of 72°F (22°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">new york</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in New York is cloudy with a temperature of 65°F (18°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">london</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in London is rainy with a temperature of 58°F (14°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">tokyo</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in Tokyo is clear with a temperature of 70°F (21°C).</span><span class="sh">"</span><span class="p">},</span>
        <span class="sh">"</span><span class="s">paris</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">report</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">The weather in Paris is partly cloudy with a temperature of 68°F (20°C).</span><span class="sh">"</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="n">city_lower</span> <span class="o">=</span> <span class="n">city</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">city_lower</span> <span class="ow">in</span> <span class="n">weather_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weather_data</span><span class="p">[</span><span class="n">city_lower</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">available_cities</span> <span class="o">=</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="n">c</span><span class="p">.</span><span class="nf">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">weather_data</span><span class="p">.</span><span class="nf">keys</span><span class="p">()])</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">error_message</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Weather information for </span><span class="sh">'</span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="sh">'</span><span class="s"> is not available. Try: </span><span class="si">{</span><span class="n">available_cities</span><span class="si">}</span><span class="sh">"</span>
        <span class="p">}</span>

<span class="n">root_agent</span> <span class="o">=</span> <span class="nc">Agent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">weather_assistant</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Fast, cost-effective Gemini model
</span>    <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">A helpful weather assistant that provides weather information for cities.</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">instruction</span><span class="o">=</span><span class="sh">"""</span><span class="s">
    You are a friendly weather assistant. When users ask about the weather:

    1. Identify the city name from their question
    2. Use the get_weather tool to fetch current weather information
    3. Respond in a friendly, conversational tone
    4. If the city isn</span><span class="sh">'</span><span class="s">t available, suggest one of the available cities

    Be helpful and concise in your responses.
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_weather</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/agent.py
</code></pre></div></div>

<hr />

<h2 id="️-section-3-deploy-to-agent-engine">☁️ Section 3: Deploy to Agent Engine</h2>

<p>ADK supports multiple deployment platforms. Learn more in the <a href="https://google.github.io/adk-docs/deploy/">ADK deployment documentation</a>.</p>

<p>You’ll be deploying to <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview">Vertex AI Agent Engine</a> in this notebook.</p>

<h3 id="-vertex-ai-agent-engine">🔷 Vertex AI Agent Engine</h3>

<ul>
  <li><strong>Fully managed</strong> service specifically for AI agents</li>
  <li><strong>Auto-scaling</strong> with session management built-in</li>
  <li><strong>Easy deployment</strong> using <a href="https://github.com/GoogleCloudPlatform/agent-starter-pack">Agent Starter Pack</a></li>
  <li>📚 <a href="https://google.github.io/adk-docs/deploy/agent-engine/">Deploy to Agent Engine Guide</a></li>
</ul>

<p><strong>Note</strong>: To help you get started with the runtime, Agent Engine offers a monthly free tier, which you can learn more about in the <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview#pricing">documentation</a>. The agent deployed in this notebook should stay within the free tier if cleaned up promptly. Note that you can incur costs if the agent is left running.</p>

<h3 id="-other-deployment-options">🚢 Other Deployment Options</h3>

<h3 id="-cloud-run">🔷 Cloud Run</h3>

<ul>
  <li>Serverless, easiest to start</li>
  <li>Perfect for demos and small-to-medium workloads</li>
  <li>📚 <a href="https://google.github.io/adk-docs/deploy/cloud-run/">Deploy to Cloud Run Guide</a></li>
</ul>

<h3 id="-google-kubernetes-engine-gke">🔷 Google Kubernetes Engine (GKE)</h3>

<ul>
  <li>Full control over containerized deployments</li>
  <li>Best for complex multi-agent systems</li>
  <li>📚 <a href="https://google.github.io/adk-docs/deploy/gke/">Deploy to GKE Guide</a></li>
</ul>

<h3 id="31-create-deployment-configuration">3.1: Create deployment configuration</h3>

<p>The <code class="language-plaintext highlighter-rouge">.agent_engine_config.json</code> file controls the deployment settings.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">agent_engine_config</span><span class="p">.</span><span class="n">json</span>
<span class="p">{</span>
    <span class="sh">"</span><span class="s">min_instances</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">max_instances</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">resource_limits</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">cpu</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">memory</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1Gi</span><span class="sh">"</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Writing sample_agent/.agent_engine_config.json
</code></pre></div></div>

<p><strong>Configuration explained:</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"min_instances": 0</code> - Scales down to zero when not in use (saves costs)</li>
  <li><code class="language-plaintext highlighter-rouge">"max_instances": 1</code> - Maximum of 1 instance running (sufficient for this demo)</li>
  <li><code class="language-plaintext highlighter-rouge">"cpu": "1"</code> - 1 CPU core per instance</li>
  <li><code class="language-plaintext highlighter-rouge">"memory": "1Gi"</code> - 1 GB of memory per instance</li>
</ul>

<p>These settings keep costs minimal while providing adequate resources for our weather agent.</p>

<h3 id="32-select-deployment-region">3.2: Select deployment region</h3>

<p>Agent Engine is available in specific regions. We’ll randomly select one for this demo.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regions_list</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">europe-west1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">europe-west4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">us-east4</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">us-west1</span><span class="sh">"</span><span class="p">]</span>
<span class="n">deployed_region</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">regions_list</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">✅ Selected deployment region: </span><span class="si">{</span><span class="n">deployed_region</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Selected deployment region: us-east4
</code></pre></div></div>

<p><strong>About regions:</strong></p>

<p>Agent Engine is available in multiple regions. For production:</p>

<ul>
  <li>Choose a region close to your users for lower latency</li>
  <li>Consider data residency requirements</li>
  <li>Check the <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/overview#locations">Agent Engine locations documentation</a></li>
</ul>

<h3 id="33-deploy-the-agent">3.3: Deploy the agent</h3>

<p>This uses the ADK CLI to deploy your agent to Agent Engine.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">adk</span> <span class="n">deploy</span> <span class="n">agent_engine</span> <span class="o">--</span><span class="n">project</span><span class="o">=</span><span class="err">$</span><span class="n">PROJECT_ID</span> <span class="o">--</span><span class="n">region</span><span class="o">=</span><span class="err">$</span><span class="n">deployed_region</span> <span class="n">sample_agent</span> <span class="o">--</span><span class="n">agent_engine_config_file</span><span class="o">=</span><span class="n">sample_agent</span><span class="o">/</span><span class="p">.</span><span class="n">agent_engine_config</span><span class="p">.</span><span class="n">json</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Staging all files in: /kaggle/working/sample_agent_tmp20251114_064442
Copying agent source code...
Copying agent source code complete.
Resolving files and dependencies...
Reading agent engine config from sample_agent/.agent_engine_config.json
Reading environment variables from /kaggle/working/sample_agent/.env
[33mIgnoring GOOGLE_CLOUD_LOCATION in .env as `--region` was explicitly passed and takes precedence[0m
Initializing Vertex AI...
Vertex AI initialized.
Created sample_agent_tmp20251114_064442/agent_engine_app.py
Files and dependencies resolved
Deploying to agent engine...
INFO:vertexai_genai.agentengines:Creating in-memory tarfile of source_packages
INFO:vertexai_genai.agentengines:Using agent framework: google-adk
Cleaning up the temp folder: sample_agent_tmp20251114_064442
[31mDeploy failed: 403 PERMISSION_DENIED. {'error': {'code': 403, 'message': 'Request had insufficient authentication scopes.', 'status': 'PERMISSION_DENIED', 'details': [{'@type': 'type.googleapis.com/google.rpc.ErrorInfo', 'reason': 'ACCESS_TOKEN_SCOPE_INSUFFICIENT', 'metadata': {'method': 'google.cloud.aiplatform.v1beta1.ReasoningEngineService.CreateReasoningEngine', 'service': 'aiplatform.googleapis.com'}}]}}[0m
</code></pre></div></div>

<p><strong>What just happened:</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">adk deploy agent_engine</code> command:</p>

<ol>
  <li>Packages your agent code (<code class="language-plaintext highlighter-rouge">sample_agent/</code> directory)</li>
  <li>Uploads it to Agent Engine</li>
  <li>Creates a containerized deployment</li>
  <li>Outputs a resource name like: <code class="language-plaintext highlighter-rouge">projects/PROJECT_NUMBER/locations/REGION/reasoningEngines/ID</code></li>
</ol>

<p><strong>Note:</strong> Deployment typically takes 2-5 minutes.</p>

<hr />

<h2 id="-section-4-retrieve-and-test-your-deployed-agent">🤖 Section 4: Retrieve and Test Your Deployed Agent</h2>

<h3 id="41-retrieve-the-deployed-agent">4.1: Retrieve the deployed agent</h3>

<p>After deploying with the CLI, we need to retrieve the agent object to interact with it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize Vertex AI
</span><span class="n">vertexai</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">PROJECT_ID</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">deployed_region</span><span class="p">)</span>

<span class="c1"># Get the most recently deployed agent
</span><span class="n">agents_list</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">agent_engines</span><span class="p">.</span><span class="nf">list</span><span class="p">())</span>
<span class="k">if</span> <span class="n">agents_list</span><span class="p">:</span>
    <span class="n">remote_agent</span> <span class="o">=</span> <span class="n">agents_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get the first (most recent) agent
</span>    <span class="n">client</span> <span class="o">=</span> <span class="n">agent_engines</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">✅ Connected to deployed agent: </span><span class="si">{</span><span class="n">remote_agent</span><span class="p">.</span><span class="n">resource_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">❌ No agents found. Please deploy first.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell retrieves your deployed agent:</p>

<ol>
  <li>Initializes the Vertex AI SDK with your project and region</li>
  <li>Lists all deployed agents in that region</li>
  <li>Gets the first one (most recently deployed)</li>
  <li>Stores it as <code class="language-plaintext highlighter-rouge">remote_agent</code> for testing</li>
</ol>

<h3 id="42-test-the-deployed-agent">4.2: Test the deployed agent</h3>

<p>Now let’s send a query to your deployed agent!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">remote_agent</span><span class="p">.</span><span class="nf">async_stream_query</span><span class="p">(</span>
    <span class="n">message</span><span class="o">=</span><span class="sh">"</span><span class="s">What is the weather in Tokyo?</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">user_id</span><span class="o">=</span><span class="sh">"</span><span class="s">user_42</span><span class="sh">"</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell tests your deployed agent:</p>

<ol>
  <li>Sends the query “What is the weather in Tokyo?”</li>
  <li>Streams the response from the agent</li>
</ol>

<p><strong>Understanding the output:</strong></p>

<p>You’ll see multiple items printed:</p>

<ol>
  <li><strong>Function call</strong> - Agent decides to call <code class="language-plaintext highlighter-rouge">get_weather</code> tool</li>
  <li><strong>Function response</strong> - Result from the tool (weather data)</li>
  <li><strong>Final response</strong> - Agent’s natural language answer</li>
</ol>

<hr />

<h2 id="-section-5-long-term-memory-with-vertex-ai-memory-bank">🧠 Section 5: Long-Term Memory with Vertex AI Memory Bank</h2>

<h3 id="what-problem-does-memory-bank-solve">What Problem Does Memory Bank Solve?</h3>

<p>Your deployed agent has <strong>session memory</strong> - it remembers the conversation while you’re chatting. But once the session ends, it forgets everything. Each new conversation starts from scratch.</p>

<p><strong>The problem:</strong></p>

<ul>
  <li>User tells agent “I prefer Celsius” today</li>
  <li>Tomorrow, user asks about weather → Agent gives Fahrenheit (forgot preference)</li>
  <li>User has to repeat preferences every time</li>
</ul>

<h3 id="-what-is-vertex-ai-memory-bank">💡 What is Vertex AI Memory Bank?</h3>

<p>Memory Bank gives your agent <strong>long-term memory across sessions</strong>:</p>

<table>
  <thead>
    <tr>
      <th>Session Memory</th>
      <th>Memory Bank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Single conversation</td>
      <td>All conversations</td>
    </tr>
    <tr>
      <td>Forgets when session ends</td>
      <td>Remembers permanently</td>
    </tr>
    <tr>
      <td>“What did I just say?”</td>
      <td>“What’s my favorite city?”</td>
    </tr>
  </tbody>
</table>

<p><strong>How it works:</strong></p>

<ol>
  <li><strong>During conversations</strong> - Agent uses memory tools to search past facts</li>
  <li><strong>After conversations</strong> - Agent Engine extracts key information (“User prefers Celsius”)</li>
  <li><strong>Next session</strong> - Agent automatically recalls and uses that information</li>
</ol>

<p><strong>Example:</strong></p>

<ul>
  <li><strong>Session 1:</strong> User: “I prefer Celsius”</li>
  <li><strong>Session 2 (days later):</strong> User: “Weather in Tokyo?” → Agent responds in Celsius automatically ✨</li>
</ul>

<h3 id="-memory-bank--your-deployment">🔧 Memory Bank &amp; Your Deployment</h3>

<p>Your Agent Engine deployment <strong>provides the infrastructure</strong> for Memory Bank, but it’s not enabled by default.</p>

<p><strong>To use Memory Bank:</strong></p>

<ol>
  <li>Add memory tools to your agent code (<code class="language-plaintext highlighter-rouge">PreloadMemoryTool</code>)</li>
  <li>Add a callback to save conversations to Memory Bank</li>
  <li>Redeploy your agent</li>
</ol>

<p>Once configured, Memory Bank works automatically - no additional infrastructure needed!</p>

<h3 id="-learn-more">📚 Learn More</h3>

<ul>
  <li><strong><a href="https://google.github.io/adk-docs/sessions/memory/">ADK Memory Guide</a></strong> - Complete guide with code examples</li>
  <li><strong><a href="https://google.github.io/adk-docs/tools/built-in-tools/">Memory Tools</a></strong> - PreloadMemory and LoadMemory documentation</li>
  <li><strong><a href="https://github.com/GoogleCloudPlatform/generative-ai/blob/main/agents/agent_engine/memory_bank/get_started_with_memory_bank_on_adk.ipynb">Get started with Memory Bank on ADK</a></strong> - Sample notebook that demonstrates how to build ADK agents with memory</li>
</ul>

<hr />

<h2 id="-section-6-cleanup">🧹 Section 6: Cleanup</h2>

<p><strong>⚠️ IMPORTANT: Prevent unexpected charges: Always delete resources when done testing!</strong></p>

<p><strong>Cost Reminders</strong></p>

<p>As a reminder, leaving the agent running can incur costs. Agent Engine offers a monthly free tier, which you can learn more about in the <a href="https://docs.cloud.google.com/agent-builder/agent-engine/overview#pricing">documentation</a>.</p>

<p><strong>Always delete resources when done testing!</strong></p>

<p>When you’re done testing and querying your deployed agent, it’s recommended to delete your remote agent to avoid incurring additional costs:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">agent_engines</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">resource_name</span><span class="o">=</span><span class="n">remote_agent</span><span class="p">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Agent successfully deleted</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>What happened:</strong></p>

<p>This cell deletes your deployed agent:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">resource_name=remote_agent.resource_name</code> - Identifies which agent to delete</li>
  <li><code class="language-plaintext highlighter-rouge">force=True</code> - Forces deletion even if the agent is running</li>
</ul>

<p>The deletion process typically takes 1-2 minutes. You can verify deletion in the <a href="https://console.cloud.google.com/vertex-ai/agents/agent-engines">Agent Engine Console</a>.</p>

<hr />

<h2 id="-congratulations-youre-ready-for-production-deployment">✅ Congratulations! You’re Ready for Production Deployment</h2>

<p>You’ve successfully learned how to deploy ADK agents to Vertex AI Agent Engine - taking your agents from development to production!</p>

<p>You now know how to deploy agents with enterprise-grade infrastructure, manage costs, and test production deployments.</p>

<h3 id="-learn-more-1">📚 Learn More</h3>

<p>Refer to the following documentation to learn more:</p>

<ul>
  <li><a href="https://google.github.io/adk-docs/">ADK Documentation</a></li>
  <li><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/agent-engine/overview">Agent Engine Documentation</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/agent-engine/">ADK Deployment Guide</a></li>
</ul>

<p><strong>Other Deployment Options:</strong></p>

<ul>
  <li><a href="https://google.github.io/adk-docs/deploy/cloud-run/">Cloud Run Deployment</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/gke/">GKE Deployment</a></li>
</ul>

<p><strong>Production Best Practices:</strong></p>

<ul>
  <li>Delete test deployments when finished to avoid costs</li>
  <li>Enable tracing (<code class="language-plaintext highlighter-rouge">enable_tracing=True</code>) for debugging</li>
  <li>Monitor via <a href="https://console.cloud.google.com/vertex-ai/agents/agent-engines">Vertex AI Console</a></li>
  <li>Follow <a href="https://google.github.io/adk-docs/safety/">security best practices</a></li>
</ul>

<h2 id="-course-recap-your-5-day-journey">🎯 Course Recap: Your 5-Day Journey</h2>

<p>Over the past 5 days, you’ve learned:</p>

<ul>
  <li><strong>Day 1:</strong> Agent fundamentals - Building your first agent with tools and instructions</li>
  <li><strong>Day 2:</strong> Advanced tools - Custom tools, built-in tools, and best practices</li>
  <li><strong>Day 3:</strong> Sessions &amp; Memory - Managing conversations and long-term knowledge storage</li>
  <li><strong>Day 4:</strong> Observability &amp; Evaluation - Monitoring agents and measuring performance</li>
  <li><strong>Day 5:</strong> Production Deployment - Taking your agents live with Agent Engine</li>
</ul>

<p>You now have the complete toolkit to build, test, and deploy production-ready AI agents!</p>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[🚀 Deploy ADK Agent to Vertex AI Agent Engine]]></summary></entry><entry><title type="html">Day 5a - Agent2Agent Communication</title><link href="daily.thekingof.cool/thoughts/2025/11/14/day-5a-agent2agent-communication.html" rel="alternate" type="text/html" title="Day 5a - Agent2Agent Communication" /><published>2025-11-14T00:00:00+08:00</published><updated>2025-11-14T00:00:00+08:00</updated><id>daily.thekingof.cool/thoughts/2025/11/14/day-5a-agent2agent-communication</id><content type="html" xml:base="daily.thekingof.cool/thoughts/2025/11/14/day-5a-agent2agent-communication.html"><![CDATA[<h1 id="-agent2agent-a2a-communication-with-adk">🤝 Agent2Agent (A2A) Communication with ADK</h1>

<p><strong>Welcome to the Kaggle 5-day Agents course!</strong></p>

<p>This notebook teaches you how to build <strong>multi-agent systems</strong> where different agents can communicate and collaborate using the <strong>Agent2Agent (A2A) Protocol</strong>. You’ll learn how to integrate with external agent services and consume remote agents as if they were local.</p>

<p>In this notebook, you’ll:</p>

<ul>
  <li>Understand the A2A protocol and when to use it vs sub-agents</li>
  <li>Learn common A2A architecture patterns (cross-framework, cross-language, cross-organization)</li>
  <li>Expose an ADK agent via A2A using <code class="language-plaintext highlighter-rouge">to_a2a()</code></li>
  <li>Consume remote agents using <code class="language-plaintext highlighter-rouge">RemoteA2aAgent</code></li>
  <li>Build a product catalog integration system</li>
</ul>

<h2 id="-overview-of-agent2agent-a2a">📚 Overview of Agent2Agent (A2A)</h2>

<h3 id="-the-problem">🤔 The Problem</h3>

<p>As you build more complex AI systems, you’ll find that:</p>
<ul>
  <li><strong>A single agent can’t do everything</strong> - Specialized agents for different domains work better</li>
  <li><strong>You need agents to collaborate</strong> - Customer support needs product data, order systems need inventory info</li>
  <li><strong>Different teams build different agents</strong> - You want to integrate agents from external vendors</li>
  <li><strong>Agents may use different languages/frameworks</strong> - You need a standard communication protocol</li>
</ul>

<h3 id="-the-solution-a2a-protocol">✅ The Solution: A2A Protocol</h3>

<p>The <a href="https://a2a-protocol.org/">Agent2Agent (A2A) Protocol</a> is a <strong>standard</strong> that allows agents to:</p>
<ul>
  <li>✨ <strong>Communicate over networks</strong> - Agents can be on different machines</li>
  <li>✨ <strong>Use each other’s capabilities</strong> - One agent can call another agent like a tool</li>
  <li>✨ <strong>Work across frameworks</strong> - Language/framework agnostic</li>
  <li>✨ <strong>Maintain formal contracts</strong> - Agent cards describe capabilities</li>
</ul>

<h3 id="️-common-a2a-architecture-patterns">🏗️ Common A2A Architecture Patterns</h3>

<p>The A2A protocol is particularly useful in three scenarios:</p>

<p><img src="https://storage.googleapis.com/github-repo/kaggle-5days-ai/day5/a2a_01.png" alt="When to choose A2A?" /></p>

<ol>
  <li><strong>Cross-Framework Integration</strong>: ADK agent communicating with other agent frameworks</li>
  <li><strong>Cross-Language Communication</strong>: Python agent calling Java or Node.js agent</li>
  <li><strong>Cross-Organization Boundaries</strong>: Your internal agent integrating with external vendor services</li>
</ol>

<h3 id="-what-this-notebook-demonstrates">📋 What This Notebook Demonstrates</h3>

<p>We’ll build a practical e-commerce integration:</p>
<ol>
  <li><strong>Product Catalog Agent</strong> (exposed via A2A) - External vendor service that provides product information</li>
  <li><strong>Customer Support Agent</strong> (consumer) - Your internal agent that helps customers by querying product data</li>
</ol>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──────────────────────┐           ┌──────────────────────┐
│ Customer Support     │  ─A2A──▶  │ Product Catalog      │
│ Agent (Consumer)     │           │ Agent (Vendor)       │
│ Your Company         │           │ External Service     │
│ (localhost:8000)     │           │ (localhost:8001)     │
└──────────────────────┘           └──────────────────────┘
</code></pre></div></div>

<p><strong>Why this justifies A2A:</strong></p>
<ul>
  <li>Product Catalog is maintained by an external vendor (you can’t modify their code)</li>
  <li>Different organizations with separate systems</li>
  <li>Formal contract needed between services</li>
  <li>Product Catalog could be in a different language/framework</li>
</ul>

<h3 id="-a2a-vs-local-sub-agents-decision-table">💡 A2A vs Local Sub-Agents: Decision Table</h3>

<table>
  <thead>
    <tr>
      <th>Factor</th>
      <th>Use A2A</th>
      <th>Use Local Sub-Agents</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Agent Location</strong></td>
      <td>External service, different codebase</td>
      <td>Same codebase, internal</td>
    </tr>
    <tr>
      <td><strong>Ownership</strong></td>
      <td>Different team/organization</td>
      <td>Your team</td>
    </tr>
    <tr>
      <td><strong>Network</strong></td>
      <td>Agents on different machines</td>
      <td>Same process/machine</td>
    </tr>
    <tr>
      <td><strong>Performance</strong></td>
      <td>Network latency acceptable</td>
      <td>Need low latency</td>
    </tr>
    <tr>
      <td><strong>Language/Framework</strong></td>
      <td>Cross-language/framework needed</td>
      <td>Same language</td>
    </tr>
    <tr>
      <td><strong>Contract</strong></td>
      <td>Formal API contract required</td>
      <td>Internal interface</td>
    </tr>
    <tr>
      <td><strong>Example</strong></td>
      <td>External vendor product catalog</td>
      <td>Internal order processing steps</td>
    </tr>
  </tbody>
</table>

<h3 id="-tutorial-context">📝 Tutorial Context</h3>

<p><strong>In this tutorial</strong>, we’ll simulate both agents locally (both running on localhost) for learning purposes. In production:</p>
<ul>
  <li>Product Catalog Agent would run on vendor’s infrastructure (e.g., <code class="language-plaintext highlighter-rouge">https://vendor.com</code>)</li>
  <li>Customer Support Agent would run on your infrastructure</li>
  <li>They’d communicate over the internet using A2A protocol</li>
</ul>

<p>This local simulation lets you learn A2A without needing to deploy services!</p>

<hr />

<h3 id="-what-well-build">🔄 What We’ll Build</h3>

<p>Here’s a high-level view of the system architecture you’ll create in this tutorial:</p>

<p><img src="https://storage.googleapis.com/github-repo/kaggle-5days-ai/day5/a2a_02.png" alt="" /></p>

<p><strong>How it works:</strong></p>
<ol>
  <li><strong>Customer</strong> asks a product question to your Customer Support Agent</li>
  <li><strong>Support Agent</strong> realizes it needs product information</li>
  <li><strong>Support Agent</strong> calls the <strong>Product Catalog Agent</strong> via A2A protocol</li>
  <li><strong>Product Catalog Agent</strong> (external vendor) returns product data</li>
  <li><strong>Support Agent</strong> formulates an answer and responds to the customer</li>
</ol>

<hr />

<h3 id="️-tutorial-steps">🗺️ Tutorial Steps</h3>

<p>In this tutorial, you’ll complete <strong>6 steps</strong>:</p>

<ol>
  <li><strong>Create the Product Catalog Agent</strong> - Build the vendor’s agent with product lookup</li>
  <li><strong>Expose via A2A</strong> - Make it accessible using <code class="language-plaintext highlighter-rouge">to_a2a()</code></li>
  <li><strong>Start the Server</strong> - Run the agent as a background service</li>
  <li><strong>Create the Customer Support Agent</strong> - Build the consumer agent</li>
  <li><strong>Test Communication</strong> - See A2A in action with real queries</li>
  <li><strong>Understand the Flow</strong> - Learn what happened behind the scenes</li>
</ol>

<p>Let’s get started! 🚀</p>

<h2 id="️-setup">⚙️ Setup</h2>

<p>Before we go into today’s concepts, follow the steps below to set up the environment.</p>

<h3 id="install-dependencies">Install dependencies</h3>

<p>The Kaggle Notebooks environment includes a pre-installed version of the <a href="https://google.github.io/adk-docs/">google-adk</a> library for Python and its required dependencies, so you don’t need to install additional packages in this notebook.</p>

<p>To install and use ADK, including A2A and its dependencies, in your own Python development environment outside of this course, you can do so by running:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -q google-adk[a2a]
</code></pre></div></div>

<h3 id="configure-your-gemini-api-key">Configure your Gemini API Key</h3>

<p>This notebook uses the <a href="https://ai.google.dev/gemini-api/">Gemini API</a>, which requires an API key.</p>

<p><strong>1. Get your API key</strong></p>

<p>If you don’t have one already, create an <a href="https://aistudio.google.com/app/api-keys">API key in Google AI Studio</a>.</p>

<p><strong>2. Add the key to Kaggle Secrets</strong></p>

<p>Next, you will need to add your API key to your Kaggle Notebook as a Kaggle User Secret.</p>

<ol>
  <li>In the top menu bar of the notebook editor, select <code class="language-plaintext highlighter-rouge">Add-ons</code> then <code class="language-plaintext highlighter-rouge">Secrets</code>.</li>
  <li>Create a new secret with the label <code class="language-plaintext highlighter-rouge">GOOGLE_API_KEY</code>.</li>
  <li>Paste your API key into the “Value” field and click “Save”.</li>
  <li>Ensure that the checkbox next to <code class="language-plaintext highlighter-rouge">GOOGLE_API_KEY</code> is selected so that the secret is attached to the notebook.</li>
</ol>

<p><strong>3. Authenticate in the notebook</strong></p>

<p>Run the cell below to access the <code class="language-plaintext highlighter-rouge">GOOGLE_API_KEY</code> you just saved and set it as an environment variable for the notebook to use:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">kaggle_secrets</span> <span class="kn">import</span> <span class="n">UserSecretsClient</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">GOOGLE_API_KEY</span> <span class="o">=</span> <span class="nc">UserSecretsClient</span><span class="p">().</span><span class="nf">get_secret</span><span class="p">(</span><span class="sh">"</span><span class="s">GOOGLE_API_KEY</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="sh">"</span><span class="s">GOOGLE_API_KEY</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">GOOGLE_API_KEY</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Setup and authentication complete.</span><span class="sh">"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="sh">"</span><span class="s">🔑 Authentication Error: Please make sure you have added </span><span class="sh">'</span><span class="s">GOOGLE_API_KEY</span><span class="sh">'</span><span class="s"> to your Kaggle secrets. Details: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span>
    <span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Setup and authentication complete.
</code></pre></div></div>

<h3 id="import-adk-components">Import ADK components</h3>

<p>Now, import the specific components you’ll need from the Agent Development Kit and the Generative AI library. This keeps your code organized and ensures we have access to the necessary building blocks.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">uuid</span>

<span class="kn">from</span> <span class="n">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
<span class="kn">from</span> <span class="n">google.adk.agents.remote_a2a_agent</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RemoteA2aAgent</span><span class="p">,</span>
    <span class="n">AGENT_CARD_WELL_KNOWN_PATH</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="n">google.adk.a2a.utils.agent_to_a2a</span> <span class="kn">import</span> <span class="n">to_a2a</span>
<span class="kn">from</span> <span class="n">google.adk.models.google_llm</span> <span class="kn">import</span> <span class="n">Gemini</span>
<span class="kn">from</span> <span class="n">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
<span class="kn">from</span> <span class="n">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
<span class="kn">from</span> <span class="n">google.genai</span> <span class="kn">import</span> <span class="n">types</span>

<span class="c1"># Hide additional warnings in the notebook
</span><span class="kn">import</span> <span class="n">warnings</span>

<span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">"</span><span class="s">ignore</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ ADK components imported successfully.</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ ADK components imported successfully.
</code></pre></div></div>

<h3 id="configure-retry-options">Configure Retry Options</h3>

<p>When working with LLMs, you may encounter transient errors like rate limits or temporary service unavailability. Retry options automatically handle these failures by retrying the request with exponential backoff.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">retry_config</span> <span class="o">=</span> <span class="n">types</span><span class="p">.</span><span class="nc">HttpRetryOptions</span><span class="p">(</span>
    <span class="n">attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Maximum retry attempts
</span>    <span class="n">exp_base</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Delay multiplier
</span>    <span class="n">initial_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">http_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>  <span class="c1"># Retry on these HTTP errors
</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-section-1-create-the-product-catalog-agent-to-be-exposed">📦 Section 1: Create the Product Catalog Agent (To Be Exposed)</h2>

<p>We’ll create a <strong>Product Catalog Agent</strong> that provides product information from an external vendor’s catalog. This agent will be <strong>exposed via A2A</strong> so other agents (like customer support) can use it.</p>

<h3 id="why-expose-this-agent">Why expose this agent?</h3>
<ul>
  <li>In a real system, this would be maintained by an <strong>external vendor</strong> or third-party provider</li>
  <li>Your internal agents (customer support, sales, inventory) need product data</li>
  <li>The vendor <strong>controls their own codebase</strong> - you can’t modify their implementation</li>
  <li>By exposing it via A2A, any authorized agent can consume it using the standard protocol</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define a product catalog lookup tool
# In a real system, this would query the vendor's product database
</span><span class="k">def</span> <span class="nf">get_product_info</span><span class="p">(</span><span class="n">product_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Get product information for a given product.

    Args:
        product_name: Name of the product (e.g., </span><span class="sh">"</span><span class="s">iPhone 15 Pro</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">MacBook Pro</span><span class="sh">"</span><span class="s">)

    Returns:
        Product information as a string
    </span><span class="sh">"""</span>
    <span class="c1"># Mock product catalog - in production, this would query a real database
</span>    <span class="n">product_catalog</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">iphone 15 pro</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">iPhone 15 Pro, $999, Low Stock (8 units), 128GB, Titanium finish</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">samsung galaxy s24</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Samsung Galaxy S24, $799, In Stock (31 units), 256GB, Phantom Black</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">dell xps 15</span><span class="sh">"</span><span class="p">:</span> <span class="sh">'</span><span class="s">Dell XPS 15, $1,299, In Stock (45 units), 15.6</span><span class="sh">"</span><span class="s"> display, 16GB RAM, 512GB SSD</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">macbook pro 14</span><span class="sh">"</span><span class="p">:</span> <span class="sh">'</span><span class="s">MacBook Pro 14</span><span class="sh">"</span><span class="s">, $1,999, In Stock (22 units), M3 Pro chip, 18GB RAM, 512GB SSD</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">sony wh-1000xm5</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Sony WH-1000XM5 Headphones, $399, In Stock (67 units), Noise-canceling, 30hr battery</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">ipad air</span><span class="sh">"</span><span class="p">:</span> <span class="sh">'</span><span class="s">iPad Air, $599, In Stock (28 units), 10.9</span><span class="sh">"</span><span class="s"> display, 64GB</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">lg ultrawide 34</span><span class="sh">"</span><span class="p">:</span> <span class="sh">'</span><span class="s">LG UltraWide 34</span><span class="sh">"</span><span class="s"> Monitor, $499, Out of Stock, Expected: Next week</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">product_lower</span> <span class="o">=</span> <span class="n">product_name</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">product_lower</span> <span class="ow">in</span> <span class="n">product_catalog</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Product: </span><span class="si">{</span><span class="n">product_catalog</span><span class="p">[</span><span class="n">product_lower</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="n">p</span><span class="p">.</span><span class="nf">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">product_catalog</span><span class="p">.</span><span class="nf">keys</span><span class="p">()])</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Sorry, I don</span><span class="sh">'</span><span class="s">t have information for </span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s">. Available products: </span><span class="si">{</span><span class="n">available</span><span class="si">}</span><span class="sh">"</span>


<span class="c1"># Create the Product Catalog Agent
# This agent specializes in providing product information from the vendor's catalog
</span><span class="n">product_catalog_agent</span> <span class="o">=</span> <span class="nc">LlmAgent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="nc">Gemini</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">,</span> <span class="n">retry_options</span><span class="o">=</span><span class="n">retry_config</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">product_catalog_agent</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">External vendor</span><span class="sh">'</span><span class="s">s product catalog agent that provides product information and availability.</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">instruction</span><span class="o">=</span><span class="sh">"""</span><span class="s">
    You are a product catalog specialist from an external vendor.
    When asked about products, use the get_product_info tool to fetch data from the catalog.
    Provide clear, accurate product information including price, availability, and specs.
    If asked about multiple products, look up each one.
    Be professional and helpful.
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_product_info</span><span class="p">],</span>  <span class="c1"># Register the product lookup tool
</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Product Catalog Agent created successfully!</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Model: gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Tool: get_product_info()</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Ready to be exposed via A2A...</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Product Catalog Agent created successfully!
   Model: gemini-2.5-flash-lite
   Tool: get_product_info()
   Ready to be exposed via A2A...
</code></pre></div></div>

<h2 id="-section-2-expose-the-product-catalog-agent-via-a2a">🌐 Section 2: Expose the Product Catalog Agent via A2A</h2>

<p>Now we’ll use ADK’s <code class="language-plaintext highlighter-rouge">to_a2a()</code> function to make our Product Catalog Agent accessible to other agents.</p>

<h3 id="what-to_a2a-does">What <code class="language-plaintext highlighter-rouge">to_a2a()</code> does:</h3>
<ul>
  <li>🔧 Wraps your agent in an A2A-compatible server (FastAPI/Starlette)</li>
  <li>📋 Auto-generates an <strong>agent card</strong> that includes:
    <ul>
      <li>Agent name, description, and version</li>
      <li>Skills (your tools/functions become “skills” in A2A)</li>
      <li>Protocol version and endpoints</li>
      <li>Input/output modes</li>
    </ul>
  </li>
  <li>🌐 Serves the agent card at <code class="language-plaintext highlighter-rouge">/.well-known/agent-card.json</code> (standard A2A path)</li>
  <li>✨ Handles all A2A protocol details (request/response formatting, task endpoints)</li>
</ul>

<p>This is the <strong>easiest way</strong> to expose an ADK agent via A2A!</p>

<p><strong>💡 Key Concept: Agent Cards</strong></p>

<p>An <strong>agent card</strong> is a JSON document that serves as a “business card” for your agent. It describes:</p>
<ul>
  <li>What the agent does (name, description, version)</li>
  <li>What capabilities it has (skills, tools, functions)</li>
  <li>How to communicate with it (URL, protocol version, endpoints)</li>
</ul>

<p>Every A2A agent must publish its agent card at the standard path: <code class="language-plaintext highlighter-rouge">/.well-known/agent-card.json</code></p>

<p>Think of it as the “contract” that tells other agents how to work with your agent.</p>

<p>📖 <strong>Learn more:</strong></p>
<ul>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-exposing/">Exposing Agents with ADK</a></li>
  <li><a href="https://a2a-protocol.org/latest/specification/">A2A Protocol Specification</a></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Convert the product catalog agent to an A2A-compatible application
# This creates a FastAPI/Starlette app that:
#   1. Serves the agent at the A2A protocol endpoints
#   2. Provides an auto-generated agent card
#   3. Handles A2A communication protocol
</span><span class="n">product_catalog_a2a_app</span> <span class="o">=</span> <span class="nf">to_a2a</span><span class="p">(</span>
    <span class="n">product_catalog_agent</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span>  <span class="c1"># Port where this agent will be served
</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Product Catalog Agent is now A2A-compatible!</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Agent will be served at: http://localhost:8001</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Agent card will be at: http://localhost:8001/.well-known/agent-card.json</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Ready to start the server...</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Product Catalog Agent is now A2A-compatible!
   Agent will be served at: http://localhost:8001
   Agent card will be at: http://localhost:8001/.well-known/agent-card.json
   Ready to start the server...
</code></pre></div></div>

<h2 id="-section-3-start-the-product-catalog-agent-server">🚀 Section 3: Start the Product Catalog Agent Server</h2>

<p>We’ll start the Product Catalog Agent server in the <strong>background</strong> using <code class="language-plaintext highlighter-rouge">uvicorn</code>, so it can serve requests from other agents.</p>

<h3 id="why-run-in-background">Why run in background?</h3>
<ul>
  <li>The server needs to keep running while we create and test the Customer Support Agent</li>
  <li>This simulates a real-world scenario where different agents run as separate services</li>
  <li>In production, the vendor would host this on their infrastructure</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First, let's save the product catalog agent to a file that uvicorn can import
</span><span class="n">product_catalog_agent_code</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
import os
from google.adk.agents import LlmAgent
from google.adk.a2a.utils.agent_to_a2a import to_a2a
from google.adk.models.google_llm import Gemini
from google.genai import types

retry_config = types.HttpRetryOptions(
    attempts=5,  # Maximum retry attempts
    exp_base=7,  # Delay multiplier
    initial_delay=1,
    http_status_codes=[429, 500, 503, 504],  # Retry on these HTTP errors
)

def get_product_info(product_name: str) -&gt; str:
    </span><span class="sh">"""</span><span class="s">Get product information for a given product.</span><span class="sh">"""</span><span class="s">
    product_catalog = {
        </span><span class="sh">"</span><span class="s">iphone 15 pro</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">iPhone 15 Pro, $999, Low Stock (8 units), 128GB, Titanium finish</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">samsung galaxy s24</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Samsung Galaxy S24, $799, In Stock (31 units), 256GB, Phantom Black</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">dell xps 15</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Dell XPS 15, $1,299, In Stock (45 units), 15.6</span><span class="se">\\</span><span class="sh">"</span><span class="s"> display, 16GB RAM, 512GB SSD</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">macbook pro 14</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">MacBook Pro 14</span><span class="se">\\</span><span class="sh">"</span><span class="s">, $1,999, In Stock (22 units), M3 Pro chip, 18GB RAM, 512GB SSD</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">sony wh-1000xm5</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Sony WH-1000XM5 Headphones, $399, In Stock (67 units), Noise-canceling, 30hr battery</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">ipad air</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">iPad Air, $599, In Stock (28 units), 10.9</span><span class="se">\\</span><span class="sh">"</span><span class="s"> display, 64GB</span><span class="sh">"</span><span class="s">,
        </span><span class="sh">"</span><span class="s">lg ultrawide 34</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">LG UltraWide 34</span><span class="se">\\</span><span class="sh">"</span><span class="s"> Monitor, $499, Out of Stock, Expected: Next week</span><span class="sh">"</span><span class="s">,
    }
    
    product_lower = product_name.lower().strip()
    
    if product_lower in product_catalog:
        return f</span><span class="sh">"</span><span class="s">Product: {product_catalog[product_lower]}</span><span class="sh">"</span><span class="s">
    else:
        available = </span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">.join([p.title() for p in product_catalog.keys()])
        return f</span><span class="sh">"</span><span class="s">Sorry, I don</span><span class="sh">'</span><span class="s">t have information for {product_name}. Available products: {available}</span><span class="sh">"</span><span class="s">

product_catalog_agent = LlmAgent(
    model=Gemini(model=</span><span class="sh">"</span><span class="s">gemini-2.5-flash-lite</span><span class="sh">"</span><span class="s">, retry_options=retry_config),
    name=</span><span class="sh">"</span><span class="s">product_catalog_agent</span><span class="sh">"</span><span class="s">,
    description=</span><span class="sh">"</span><span class="s">External vendor</span><span class="sh">'</span><span class="s">s product catalog agent that provides product information and availability.</span><span class="sh">"</span><span class="s">,
    instruction=</span><span class="sh">"""</span><span class="s">
    You are a product catalog specialist from an external vendor.
    When asked about products, use the get_product_info tool to fetch data from the catalog.
    Provide clear, accurate product information including price, availability, and specs.
    If asked about multiple products, look up each one.
    Be professional and helpful.
    </span><span class="sh">"""</span><span class="s">,
    tools=[get_product_info]
)

# Create the A2A app
app = to_a2a(product_catalog_agent, port=8001)
</span><span class="sh">'''</span>

<span class="c1"># Write the product catalog agent to a temporary file
</span><span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">/tmp/product_catalog_server.py</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">product_catalog_agent_code</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">📝 Product Catalog agent code saved to /tmp/product_catalog_server.py</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Start uvicorn server in background
# Note: We redirect output to avoid cluttering the notebook
</span><span class="n">server_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nc">Popen</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="sh">"</span><span class="s">uvicorn</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">product_catalog_server:app</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Module:app format
</span>        <span class="sh">"</span><span class="s">--host</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">--port</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">8001</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">cwd</span><span class="o">=</span><span class="sh">"</span><span class="s">/tmp</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Run from /tmp where the file is
</span>    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">},</span>  <span class="c1"># Pass environment variables (including GOOGLE_API_KEY)
</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">🚀 Starting Product Catalog Agent server...</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Waiting for server to be ready...</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Wait for server to start (poll until it responds)
</span><span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">http://localhost:8001/.well-known/agent-card.json</span><span class="sh">"</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">✅ Product Catalog Agent server is running!</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Server URL: http://localhost:8001</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Agent card: http://localhost:8001/.well-known/agent-card.json</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span><span class="p">:</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="sh">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">⚠️  Server may not be ready yet. Check manually if needed.</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Store the process so we can stop it later
</span><span class="nf">globals</span><span class="p">()[</span><span class="sh">"</span><span class="s">product_catalog_server_process</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">server_process</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📝 Product Catalog agent code saved to /tmp/product_catalog_server.py
🚀 Starting Product Catalog Agent server...
   Waiting for server to be ready...
......
✅ Product Catalog Agent server is running!
   Server URL: http://localhost:8001
   Agent card: http://localhost:8001/.well-known/agent-card.json
</code></pre></div></div>

<h3 id="-view-the-auto-generated-agent-card">🔍 View the Auto-Generated Agent Card</h3>

<p>The <code class="language-plaintext highlighter-rouge">to_a2a()</code> function automatically created an <strong>agent card</strong> that describes the Product Catalog Agent’s capabilities. Let’s take a look!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fetch the agent card from the running server
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">http://localhost:8001/.well-known/agent-card.json</span><span class="sh">"</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">agent_card</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">📋 Product Catalog Agent Card:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">agent_card</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">✨ Key Information:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Name: </span><span class="si">{</span><span class="n">agent_card</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Description: </span><span class="si">{</span><span class="n">agent_card</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   URL: </span><span class="si">{</span><span class="n">agent_card</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">url</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Skills: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">agent_card</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">skills</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]))</span><span class="si">}</span><span class="s"> capabilities exposed</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">❌ Failed to fetch agent card: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">❌ Error fetching agent card: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Make sure the Product Catalog Agent server is running (previous cell)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📋 Product Catalog Agent Card:
{
  "capabilities": {},
  "defaultInputModes": [
    "text/plain"
  ],
  "defaultOutputModes": [
    "text/plain"
  ],
  "description": "External vendor's product catalog agent that provides product information and availability.",
  "name": "product_catalog_agent",
  "preferredTransport": "JSONRPC",
  "protocolVersion": "0.3.0",
  "skills": [
    {
      "description": "External vendor's product catalog agent that provides product information and availability. \n    I am a product catalog specialist from an external vendor.\n    When asked about products, use the get_product_info tool to fetch data from the catalog.\n    Provide clear, accurate product information including price, availability, and specs.\n    If asked about multiple products, look up each one.\n    Be professional and helpful.\n    ",
      "id": "product_catalog_agent",
      "name": "model",
      "tags": [
        "llm"
      ]
    },
    {
      "description": "Get product information for a given product.",
      "id": "product_catalog_agent-get_product_info",
      "name": "get_product_info",
      "tags": [
        "llm",
        "tools"
      ]
    }
  ],
  "supportsAuthenticatedExtendedCard": false,
  "url": "http://localhost:8001",
  "version": "0.0.1"
}

✨ Key Information:
   Name: product_catalog_agent
   Description: External vendor's product catalog agent that provides product information and availability.
   URL: http://localhost:8001
   Skills: 2 capabilities exposed
</code></pre></div></div>

<h2 id="-section-4-create-the-customer-support-agent-consumer">🎧 Section 4: Create the Customer Support Agent (Consumer)</h2>

<p>Now we’ll create a <strong>Customer Support Agent</strong> that consumes the Product Catalog Agent using A2A.</p>

<h3 id="how-it-works">How it works:</h3>
<ol>
  <li>We use <code class="language-plaintext highlighter-rouge">RemoteA2aAgent</code> to create a <strong>client-side proxy</strong> for the Product Catalog Agent</li>
  <li>The Customer Support Agent can use the Product Catalog Agent like any other tool</li>
  <li>ADK handles all the A2A protocol communication behind the scenes</li>
</ol>

<p>This demonstrates the power of A2A: <strong>agents can collaborate as if they were local!</strong></p>

<p><strong>How RemoteA2aAgent works:</strong></p>
<ul>
  <li>It’s a <strong>client-side proxy</strong> that reads the remote agent’s card</li>
  <li>Translates sub-agent calls into A2A protocol requests (HTTP POST to <code class="language-plaintext highlighter-rouge">/tasks</code>)</li>
  <li>Handles all the protocol details so you just use it like a regular sub-agent</li>
</ul>

<p>📖 <strong>Learn more:</strong></p>
<ul>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-consuming/">Consuming Remote Agents with ADK</a></li>
  <li><a href="https://a2a-protocol.org/latest/topics/what-is-a2a/">What is A2A?</a></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a RemoteA2aAgent that connects to our Product Catalog Agent
# This acts as a client-side proxy - the Customer Support Agent can use it like a local agent
</span><span class="n">remote_product_catalog_agent</span> <span class="o">=</span> <span class="nc">RemoteA2aAgent</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">product_catalog_agent</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">Remote product catalog agent from external vendor that provides product information.</span><span class="sh">"</span><span class="p">,</span>
    <span class="c1"># Point to the agent card URL - this is where the A2A protocol metadata lives
</span>    <span class="n">agent_card</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">http://localhost:8001</span><span class="si">{</span><span class="n">AGENT_CARD_WELL_KNOWN_PATH</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
<span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Remote Product Catalog Agent proxy created!</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Connected to: http://localhost:8001</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Agent card: http://localhost:8001</span><span class="si">{</span><span class="n">AGENT_CARD_WELL_KNOWN_PATH</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   The Customer Support Agent can now use this like a local sub-agent!</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Remote Product Catalog Agent proxy created!
   Connected to: http://localhost:8001
   Agent card: http://localhost:8001/.well-known/agent-card.json
   The Customer Support Agent can now use this like a local sub-agent!
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Now create the Customer Support Agent that uses the remote Product Catalog Agent
</span><span class="n">customer_support_agent</span> <span class="o">=</span> <span class="nc">LlmAgent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="nc">Gemini</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">,</span> <span class="n">retry_options</span><span class="o">=</span><span class="n">retry_config</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">customer_support_agent</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">A customer support assistant that helps customers with product inquiries and information.</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">instruction</span><span class="o">=</span><span class="sh">"""</span><span class="s">
    You are a friendly and professional customer support agent.
    
    When customers ask about products:
    1. Use the product_catalog_agent sub-agent to look up product information
    2. Provide clear answers about pricing, availability, and specifications
    3. If a product is out of stock, mention the expected availability
    4. Be helpful and professional!
    
    Always get product information from the product_catalog_agent before answering customer questions.
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">sub_agents</span><span class="o">=</span><span class="p">[</span><span class="n">remote_product_catalog_agent</span><span class="p">],</span>  <span class="c1"># Add the remote agent as a sub-agent!
</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Customer Support Agent created!</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Model: gemini-2.5-flash-lite</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Sub-agents: 1 (remote Product Catalog Agent via A2A)</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Ready to help customers!</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Customer Support Agent created!
   Model: gemini-2.5-flash-lite
   Sub-agents: 1 (remote Product Catalog Agent via A2A)
   Ready to help customers!
</code></pre></div></div>

<h2 id="-section-5-test-a2a-communication">🧪 Section 5: Test A2A Communication</h2>

<p>Let’s test the agent-to-agent communication! We’ll ask the Customer Support Agent about products, and it will communicate with the Product Catalog Agent via A2A.</p>

<h3 id="what-happens-behind-the-scenes">What happens behind the scenes:</h3>
<ol>
  <li>Customer asks Support Agent a question about a product</li>
  <li>Support Agent realizes it needs product info</li>
  <li>Support Agent calls the <code class="language-plaintext highlighter-rouge">remote_product_catalog_agent</code> (RemoteA2aAgent)</li>
  <li>ADK sends an A2A protocol request to <code class="language-plaintext highlighter-rouge">http://localhost:8001</code></li>
  <li>Product Catalog Agent processes the request and responds</li>
  <li>Support Agent receives the response and continues</li>
  <li>Customer gets the final answer</li>
</ol>

<p>All of this happens <strong>transparently</strong> - the Support Agent doesn’t need to know it’s talking to a remote agent!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">test_a2a_communication</span><span class="p">(</span><span class="n">user_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Test the A2A communication between Customer Support Agent and Product Catalog Agent.

    This function:
    1. Creates a new session for this conversation
    2. Sends the query to the Customer Support Agent
    3. Support Agent communicates with Product Catalog Agent via A2A
    4. Displays the response

    Args:
        user_query: The question to ask the Customer Support Agent
    </span><span class="sh">"""</span>
    <span class="c1"># Setup session management (required by ADK)
</span>    <span class="n">session_service</span> <span class="o">=</span> <span class="nc">InMemorySessionService</span><span class="p">()</span>

    <span class="c1"># Session identifiers
</span>    <span class="n">app_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">support_app</span><span class="sh">"</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="sh">"</span><span class="s">demo_user</span><span class="sh">"</span>
    <span class="c1"># Use unique session ID for each test to avoid conflicts
</span>    <span class="n">session_id</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">demo_session_</span><span class="si">{</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">().</span><span class="nb">hex</span><span class="p">[</span><span class="si">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>

    <span class="c1"># CRITICAL: Create session BEFORE running agent (synchronous, not async!)
</span>    <span class="c1"># This pattern matches the deployment notebook exactly
</span>    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="p">.</span><span class="nf">create_session</span><span class="p">(</span>
        <span class="n">app_name</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span>
    <span class="p">)</span>

    <span class="c1"># Create runner for the Customer Support Agent
</span>    <span class="c1"># The runner manages the agent execution and session state
</span>    <span class="n">runner</span> <span class="o">=</span> <span class="nc">Runner</span><span class="p">(</span>
        <span class="n">agent</span><span class="o">=</span><span class="n">customer_support_agent</span><span class="p">,</span> <span class="n">app_name</span><span class="o">=</span><span class="n">app_name</span><span class="p">,</span> <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
    <span class="p">)</span>

    <span class="c1"># Create the user message
</span>    <span class="c1"># This follows the same pattern as the deployment notebook
</span>    <span class="n">test_content</span> <span class="o">=</span> <span class="n">types</span><span class="p">.</span><span class="nc">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="p">.</span><span class="nc">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">user_query</span><span class="p">)])</span>

    <span class="c1"># Display query
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">👤 Customer: </span><span class="si">{</span><span class="n">user_query</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">🎧 Support Agent response:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

    <span class="c1"># Run the agent asynchronously (handles streaming responses and A2A communication)
</span>    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="p">.</span><span class="nf">run_async</span><span class="p">(</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">test_content</span>
    <span class="p">):</span>
        <span class="c1"># Print final response only (skip intermediate events)
</span>        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nf">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="p">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">event</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">parts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">):</span>
                    <span class="nf">print</span><span class="p">(</span><span class="n">part</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>


<span class="c1"># Run the test
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">🧪 Testing A2A Communication...</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
<span class="k">await</span> <span class="nf">test_a2a_communication</span><span class="p">(</span><span class="sh">"</span><span class="s">Can you tell me about the iPhone 15 Pro? Is it in stock?</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>🧪 Testing A2A Communication...


👤 Customer: Can you tell me about the iPhone 15 Pro? Is it in stock?

🎧 Support Agent response:
------------------------------------------------------------


INFO:google_adk.google.adk.models.google_llm:Sending out request, model: gemini-2.5-flash-lite, backend: GoogleLLMVariant.GEMINI_API, stream: False
INFO:google_adk.google.adk.models.google_llm:Response received from the model.
WARNING:google_genai.types:Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.
INFO:google_adk.google.adk.agents.remote_a2a_agent:Successfully resolved remote A2A agent: product_catalog_agent


The iPhone 15 Pro is available for $999. We have a low stock of 8 units remaining. It comes with a 128GB storage capacity and a titanium finish.
------------------------------------------------------------
</code></pre></div></div>

<h3 id="try-more-examples">Try More Examples</h3>

<p>Let’s test a few more scenarios to see A2A communication in action!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Test comparing multiple products
</span><span class="k">await</span> <span class="nf">test_a2a_communication</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">I</span><span class="sh">'</span><span class="s">m looking for a laptop. Can you compare the Dell XPS 15 and MacBook Pro 14 for me?</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:google_adk.google.adk.models.google_llm:Sending out request, model: gemini-2.5-flash-lite, backend: GoogleLLMVariant.GEMINI_API, stream: False



👤 Customer: I'm looking for a laptop. Can you compare the Dell XPS 15 and MacBook Pro 14 for me?

🎧 Support Agent response:
------------------------------------------------------------


INFO:google_adk.google.adk.models.google_llm:Response received from the model.
WARNING:google_genai.types:Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.


Certainly! Here's a comparison of the two laptops:

**Dell XPS 15:**
*   Price: $1,299
*   Availability: In Stock (45 units)
*   Display: 15.6"
*   RAM: 16GB
*   Storage: 512GB SSD

**MacBook Pro 14":**
*   Price: $1,999
*   Availability: In Stock (22 units)
*   Chip: M3 Pro
*   RAM: 18GB
*   Storage: 512GB SSD

The MacBook Pro 14" is more expensive and has slightly more RAM, while the Dell XPS 15 offers a larger display. Both have the same storage capacity.

Let me know if you'd like more details on either model!
------------------------------------------------------------
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Test specific product inquiry
</span><span class="k">await</span> <span class="nf">test_a2a_communication</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">Do you have the Sony WH-1000XM5 headphones? What</span><span class="sh">'</span><span class="s">s the price?</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:google_adk.google.adk.models.google_llm:Sending out request, model: gemini-2.5-flash-lite, backend: GoogleLLMVariant.GEMINI_API, stream: False



👤 Customer: Do you have the Sony WH-1000XM5 headphones? What's the price?

🎧 Support Agent response:
------------------------------------------------------------


INFO:google_adk.google.adk.models.google_llm:Response received from the model.
WARNING:google_genai.types:Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.


The Sony WH-1000XM5 headphones are available for $399 and are currently in stock, with 67 units available. They feature noise-canceling technology and a 30-hour battery life.
------------------------------------------------------------
</code></pre></div></div>

<h2 id="-section-6-understanding-what-just-happened">🔍 Section 6: Understanding What Just Happened</h2>

<h3 id="a2a-communication-flow">A2A Communication Flow</h3>

<p>When you ran the tests above, here’s the detailed step-by-step flow of how the agents communicated:</p>

<p><img src="https://storage.googleapis.com/github-repo/kaggle-5days-ai/day5/a2a_03.png" alt="" /></p>

<p><strong>A2A Protocol Communication:</strong></p>

<p>Behind the scenes, here’s what happens at the protocol level:</p>
<ul>
  <li><strong>RemoteA2aAgent</strong> sends HTTP POST requests to the <code class="language-plaintext highlighter-rouge">/tasks</code> endpoint on <code class="language-plaintext highlighter-rouge">http://localhost:8001</code></li>
  <li>Request and response data follow the <a href="https://a2a-protocol.org/latest/specification/">A2A Protocol Specification</a></li>
  <li>Data is exchanged in standardized JSON format</li>
  <li>The protocol ensures any A2A-compatible agent (regardless of language/framework) can communicate</li>
</ul>

<p>This standardization is what makes cross-organization, cross-language agent communication possible!</p>

<hr />

<p><strong>What happened:</strong></p>
<ol>
  <li><strong>Customer</strong> asked about the iPhone 15 Pro</li>
  <li><strong>Customer Support Agent</strong> (LlmAgent) received the question and decided it needs product information</li>
  <li><strong>Support Agent</strong> delegated to the <code class="language-plaintext highlighter-rouge">product_catalog_agent</code> sub-agent</li>
  <li><strong>RemoteA2aAgent</strong> (client-side proxy) translated this into an A2A protocol request</li>
  <li>The A2A request was sent over HTTP to <code class="language-plaintext highlighter-rouge">http://localhost:8001</code> (highlighted in yellow)</li>
  <li><strong>Product Catalog Agent</strong> (server) received the request and called <code class="language-plaintext highlighter-rouge">get_product_info("iPhone 15 Pro")</code></li>
  <li><strong>Product Catalog Agent</strong> returned the product information via A2A response</li>
  <li><strong>RemoteA2aAgent</strong> received the response and passed it back to the Support Agent</li>
  <li><strong>Support Agent</strong> formulated a final answer with the product details</li>
  <li><strong>Customer</strong> received the complete, helpful response</li>
</ol>

<h3 id="key-benefits-demonstrated">Key Benefits Demonstrated</h3>

<ol>
  <li><strong>Transparency</strong>: Support Agent doesn’t “know” Product Catalog Agent is remote</li>
  <li><strong>Standard Protocol</strong>: Uses A2A standard - any A2A-compatible agent works</li>
  <li><strong>Easy Integration</strong>: Just one line: <code class="language-plaintext highlighter-rouge">sub_agents=[remote_product_catalog_agent]</code></li>
  <li><strong>Separation of Concerns</strong>: Product data lives in Catalog Agent (vendor), support logic in Support Agent (your company)</li>
</ol>

<h3 id="real-world-applications">Real-World Applications</h3>

<p>This pattern enables:</p>
<ul>
  <li><strong>Microservices</strong>: Each agent is an independent service</li>
  <li><strong>Third-party Integration</strong>: Consume agents from external vendors (e.g., product catalogs, payment processors)</li>
  <li><strong>Cross-language</strong>: Product Catalog Agent could be Java, Support Agent Python</li>
  <li><strong>Specialized Teams</strong>: Vendor maintains catalog, your team maintains support agent</li>
  <li><strong>Cross-Organization</strong>: Vendor hosts catalog on their infrastructure, you integrate via A2A</li>
</ul>

<h2 id="-next-steps-and-learning-resources">🎓 Next Steps and Learning Resources</h2>

<h3 id="-enhancement-ideas">🚀 Enhancement Ideas</h3>

<p>Now that you understand A2A basics, try extending this example:</p>

<ol>
  <li><strong>Add More Agents</strong>:
    <ul>
      <li>Create an <strong>Inventory Agent</strong> that checks stock levels and restocking schedules</li>
      <li>Create a <strong>Shipping Agent</strong> that provides delivery estimates and tracking</li>
      <li>Have Customer Support Agent coordinate all three via A2A</li>
    </ul>
  </li>
  <li><strong>Real Data Sources</strong>:
    <ul>
      <li>Replace mock product catalog with real database (PostgreSQL, MongoDB)</li>
      <li>Add real inventory tracking system integration</li>
      <li>Connect to real payment gateway APIs</li>
    </ul>
  </li>
  <li><strong>Advanced A2A Features</strong>:
    <ul>
      <li>Implement authentication between agents (API keys, OAuth)</li>
      <li>Add error handling and retries for network failures</li>
      <li>Use the alternative <code class="language-plaintext highlighter-rouge">adk api_server --a2a</code> approach</li>
    </ul>
  </li>
  <li><strong>Deploy to Production</strong>:
    <ul>
      <li>Deploy Product Catalog Agent to Agent Engine</li>
      <li>Update agent card URL to point to production server (e.g., <code class="language-plaintext highlighter-rouge">https://vendor-catalog.example.com</code>)</li>
      <li>Consumer agents can now access it over the internet!</li>
    </ul>
  </li>
</ol>

<h3 id="-documentation">📚 Documentation</h3>

<p><strong>A2A Protocol</strong>:</p>

<ul>
  <li><a href="https://a2a-protocol.org/">Official A2A Protocol Website</a></li>
  <li><a href="https://a2a-protocol.org/latest/spec/">A2A Protocol Specification</a></li>
</ul>

<p><strong>ADK A2A Guides</strong>:</p>

<ul>
  <li><a href="https://google.github.io/adk-docs/a2a/intro/">Introduction to A2A in ADK</a></li>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-exposing/">Exposing Agents Quickstart</a></li>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-consuming/">Consuming Agents Quickstart</a></li>
</ul>

<p><strong>Other Deployment Options</strong>:</p>

<ul>
  <li><a href="https://google.github.io/adk-docs/deploy/cloud-run/">Deploy ADK Agents to Cloud Run</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/agent-engine/">Deploy to Agent Engine</a></li>
  <li><a href="https://google.github.io/adk-docs/deploy/gke/">Deploy to GKE</a></li>
</ul>

<hr />

<h2 id="-summary---a2a-communication-patterns">📊 Summary - A2A Communication Patterns</h2>

<h3 id="key-takeaways">Key Takeaways</h3>

<p>In this notebook, you learned how to build multi-agent systems with A2A:</p>

<ul>
  <li><strong>A2A Protocol</strong>: Standardized protocol for agent-to-agent communication across networks and frameworks</li>
  <li><strong>Exposing Agents</strong>: Use <code class="language-plaintext highlighter-rouge">to_a2a()</code> to make your agents accessible to others with auto-generated agent cards</li>
  <li><strong>Consuming Agents</strong>: Use <code class="language-plaintext highlighter-rouge">RemoteA2aAgent</code> to integrate remote agents as if they were local sub-agents</li>
  <li><strong>Use Cases</strong>: Best for microservices architectures, cross-team integrations, and third-party agent consumption</li>
</ul>

<hr />

<h2 id="-congratulations-youre-an-a2a-expert">✅ Congratulations! You’re an A2A Expert</h2>

<p>You’ve successfully learned how to build multi-agent systems using the A2A protocol!</p>

<p>You now know how to expose agents as services, consume remote agents, and build collaborative multi-agent systems that can scale across teams and organizations.</p>

<h3 id="-learn-more">📚 Learn More</h3>

<p>Refer to the following documentation to learn more:</p>

<ul>
  <li><a href="https://google.github.io/adk-docs/">ADK Documentation</a></li>
  <li><a href="https://a2a-protocol.org/">A2A Protocol Official Website</a></li>
  <li><a href="https://a2a-protocol.org/latest/tutorials/">A2A Tutorials</a></li>
  <li><a href="https://google.github.io/adk-docs/a2a/intro/">Introduction to A2A in ADK</a></li>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-exposing/">Exposing Agents Quickstart</a></li>
  <li><a href="https://google.github.io/adk-docs/a2a/quickstart-consuming/">Consuming Agents Quickstart</a></li>
</ul>]]></content><author><name>thekingofcool</name></author><category term="thoughts" /><summary type="html"><![CDATA[🤝 Agent2Agent (A2A) Communication with ADK]]></summary></entry></feed>